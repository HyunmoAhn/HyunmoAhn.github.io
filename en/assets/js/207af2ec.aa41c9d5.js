"use strict";(self.webpackChunkhyunmoahn_github_io=self.webpackChunkhyunmoahn_github_io||[]).push([[414],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=d(e,["components","mdxType","originalType","parentName"]),u=l(n),m=i,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||o;return n?a.createElement(h,r(r({ref:t},p),{},{components:n})):a.createElement(h,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var d={};for(var s in t)hasOwnProperty.call(t,s)&&(d[s]=t[s]);d.originalType=e,d.mdxType="string"==typeof e?e:i,r[1]=d;for(var l=2;l<o;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6785:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return s},metadata:function(){return l},assets:function(){return p},toc:function(){return c},default:function(){return m}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],d={slug:"how-to-time-travel-debugging-at-redux-devtools",title:"how to time travel debugging at redux-devtools",description:"We will check how to time travel debugging at redux-devtools.",keywords:["redux","redux-devtools","time-travel","javascript"],authors:"HyunmoAhn",tags:["redux","redux-devtools","time-travel","library","how-to-work","javascript","web"]},s=void 0,l={permalink:"/en/how-to-time-travel-debugging-at-redux-devtools",source:"@site/i18n/en/docusaurus-plugin-content-blog/2021-10-02-how-to-time-travel-debugging-at-redux-devtools.md",title:"how to time travel debugging at redux-devtools",description:"We will check how to time travel debugging at redux-devtools.",date:"2021-10-02T00:00:00.000Z",formattedDate:"October 2, 2021",tags:[{label:"redux",permalink:"/en/tags/redux"},{label:"redux-devtools",permalink:"/en/tags/redux-devtools"},{label:"time-travel",permalink:"/en/tags/time-travel"},{label:"library",permalink:"/en/tags/library"},{label:"how-to-work",permalink:"/en/tags/how-to-work"},{label:"javascript",permalink:"/en/tags/javascript"},{label:"web",permalink:"/en/tags/web"}],readingTime:24.03,truncated:!0,authors:[{name:"Hyunmo Ahn",title:"Front End Engineer @ Line Financial+",url:"https://github.com/HyunmoAhn",imageURL:"https://github.com/HyunmoAhn.png",key:"HyunmoAhn"}],nextItem:{title:"How to cancel at axios",permalink:"/en/how-to-cancel-at-axios"}},p={authorsImageUrls:[void 0]},c=[{value:"Purpose",id:"purpose",children:[]},{value:"How to connect redux-devtools and web application?",id:"how-to-connect-redux-devtools-and-web-application",children:[{value:"Simple usage",id:"simple-usage",children:[]},{value:"Manual usage",id:"manual-usage",children:[]},{value:"Recap about devtools connection with web application",id:"recap-about-devtools-connection-with-web-application",children:[]}]},{value:"createDevTools",id:"createdevtools",children:[]},{value:"redux enhancer",id:"redux-enhancer",children:[]},{value:"instrument",id:"instrument",children:[]},{value:"unliftStore",id:"unliftstore",children:[{value:"getState",id:"getstate",children:[]},{value:"dispatch",id:"dispatch",children:[]},{value:"Recap about unliftStore",id:"recap-about-unliftstore",children:[]}]},{value:"liftReducer",id:"liftreducer",children:[{value:"initialState",id:"initialstate",children:[]},{value:"The behavior of PERFORM_ACTION",id:"the-behavior-of-perform_action",children:[]},{value:"Recap about logic of PERFORM_ACTION",id:"recap-about-logic-of-perform_action",children:[]}]},{value:"recomputeStates",id:"recomputestates",children:[{value:"Recap about recomputeStates",id:"recap-about-recomputestates",children:[]}]},{value:"The process that action is consumed with devtools",id:"the-process-that-action-is-consumed-with-devtools",children:[]},{value:"Analysis of the main behaviour of devtools",id:"analysis-of-the-main-behaviour-of-devtools",children:[{value:"How to log the actions and reducer called in redux-devtools?",id:"how-to-log-the-actions-and-reducer-called-in-redux-devtools",children:[]},{value:"How to <strong>jump</strong> to a point where specific aciton is dispatched in redux-devtools.",id:"how-to-jump-to-a-point-where-specific-aciton-is-dispatched-in-redux-devtools",children:[]},{value:"How to <strong>skip</strong> a specific action as if it did not work in redux-devtools",id:"how-to-skip-a-specific-action-as-if-it-did-not-work-in-redux-devtools",children:[]}]},{value:"Recap",id:"recap",children:[]},{value:"Reference",id:"reference",children:[]}],u={toc:c};function m(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"purpose"},"Purpose"),(0,o.kt)("p",null,"If you used ",(0,o.kt)("a",{parentName:"p",href:"https://redux.js.org/"},"redux")," in web application devlopment, you may have experience to use time-travel debugging with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/zalmoxisus/redux-devtools-extension"},"redux-devtools"),"."),(0,o.kt)("p",null,"If you have confused about what ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," is, please see below video."),(0,o.kt)("iframe",{style:{width:"100%",height:"100%"},src:"https://www.youtube.com/embed/VbPgAf3FUU8",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),(0,o.kt)("p",null,"If you don't have any experience about ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools"),", I think it may be difficult to understand this article."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," records the redux information(action, reducer state) of web applications using redux,\nrollback to the reducer at a specific point in time and can pretend that there was no specific action.\nHowever, It is not simple to try to implement similar actions inside web applictions without using ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools"),".\nFor example, If you press the A button, make as if The action that's been happening so far didn't happen\nor if you leave before pressing the Submit button, rollback all actions that occurred on the page."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," is an easy to provide function with buttons, but I don't know how to implement it myself.\nHow does ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," make these things possible?"),(0,o.kt)("p",null,"In this article, we will check below three things."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"How to ",(0,o.kt)("strong",{parentName:"li"},"log")," the actions and reducer called in ",(0,o.kt)("inlineCode",{parentName:"li"},"redux-devtools"),"."),(0,o.kt)("li",{parentName:"ul"},"How to ",(0,o.kt)("strong",{parentName:"li"},"jump")," to a point where specific aciton is dispatched in ",(0,o.kt)("inlineCode",{parentName:"li"},"redux-devtools"),"."),(0,o.kt)("li",{parentName:"ul"},"How to ",(0,o.kt)("strong",{parentName:"li"},"skip")," a specific action as if it did not work in ",(0,o.kt)("inlineCode",{parentName:"li"},"redux-devtools"))),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"PREREQUISITES")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"The experience about ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/zalmoxisus/redux-devtools-extension"},"redux-devtools")),(0,o.kt)("li",{parentName:"ul"},"The intelligence about ",(0,o.kt)("a",{parentName:"li",href:"https://redux.js.org/"},"redux")," enhancer")))),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"This article doesn't include content of ",(0,o.kt)("inlineCode",{parentName:"li"},"browser extension")),(0,o.kt)("li",{parentName:"ul"},"This article will say about core of ",(0,o.kt)("inlineCode",{parentName:"li"},"redux-devtools")," and you can understand if you don't know about ",(0,o.kt)("inlineCode",{parentName:"li"},"browser extension"),(0,o.kt)("br",null)),(0,o.kt)("li",{parentName:"ul"},"If you want to know ",(0,o.kt)("inlineCode",{parentName:"li"},"browser extension"),", It may not fit the purpose of this article.")))),(0,o.kt)("h2",{id:"how-to-connect-redux-devtools-and-web-application"},"How to connect redux-devtools and web application?"),(0,o.kt)("p",null,"We need to know how ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," can affect web applictions.",(0,o.kt)("br",null),"\nFirst, we will check guide to use ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")),(0,o.kt)("h3",{id:"simple-usage"},"Simple usage"),(0,o.kt)("p",null,"The way to apply redux-devtools with chrome extension is below. (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/zalmoxisus/redux-devtools-extension#11-basic-store"},"docs"),") "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"}," const store = createStore(\n   reducer, /* preloadedState, */\n+  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()\n );\n")),(0,o.kt)("p",null,"When we create ",(0,o.kt)("inlineCode",{parentName:"p"},"redux store"),", we inject ",(0,o.kt)("inlineCode",{parentName:"p"},"window.__REDUX_DEVTOOLS_EXTENSION__")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"enhancer"),".\nWe know that ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," use ",(0,o.kt)("inlineCode",{parentName:"p"},"enhancer")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"redux store"),", but we can't knwo where ",(0,o.kt)("inlineCode",{parentName:"p"},"window.__REDUX_DEVTOOLS_EXTENSION__")," is registered.\nAnd, if you used ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-toolkit"},"redux-toolkit"),", you might not have cared about devtools because devtools options is ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-toolkit/blob/v1.6.1/packages/toolkit/src/configureStore.ts#L63"},"set true at default value"),".\n",(0,o.kt)("inlineCode",{parentName:"p"},"redux-toolkit")," also inject same setting code internally.(",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-toolkit/blob/v1.6.1/packages/toolkit/src/devtoolsExtension.ts#L184"},"code"),")"),(0,o.kt)("p",null,"I guess ",(0,o.kt)("inlineCode",{parentName:"p"},"window.__REDUX_DEVTOOLS_EXTENSION__")," is injected from chrome extension. But we don't read chrome extension code, we will find another usage about ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools"),"."),(0,o.kt)("h3",{id:"manual-usage"},"Manual usage"),(0,o.kt)("p",null,"If we look for ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," document, we can find document that manully apply redux-devtools without using ",(0,o.kt)("inlineCode",{parentName:"p"},"browser extension"),".   "),(0,o.kt)("p",null,"In short about that document, add below dependency and create ",(0,o.kt)("inlineCode",{parentName:"p"},"createDevTools")," and add it at store enhancer."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"install dependecny")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install --save-dev @redux-devtools/core\nnpm install --save-dev @redux-devtools/log-monitor\nnpm install --save-dev @redux-devtools/dock-monitor\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"create ",(0,o.kt)("inlineCode",{parentName:"li"},"DevTools")," component")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// DevTools.tsx\nimport React from 'react';\n\nimport { createDevTools } from '@redux-devtools/core';\nimport LogMonitor from '@redux-devtools/log-monitor';\nimport DockMonitor from '@redux-devtools/dock-monitor';\n\nconst DevTools = createDevTools(\n  <DockMonitor\n    toggleVisibilityKey=\"ctrl-h\"\n    changePositionKey=\"ctrl-q\"\n    defaultIsVisible={true}\n  >\n    <LogMonitor theme=\"tomorrow\" />\n  </DockMonitor>\n);\n\nexport default DevTools;\n")),(0,o.kt)("p",null,"we will create ",(0,o.kt)("inlineCode",{parentName:"p"},"DevTools")," component using ",(0,o.kt)("inlineCode",{parentName:"p"},"createDevTools")," interface in ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools/core"),".\nThis ",(0,o.kt)("inlineCode",{parentName:"p"},"DevTools")," component have a two roles.\nFirst is a devtools component to show inner web application. By manual usage, it is possible to use a way that can be operated by displaying devtools on web application rather than by browser extension.\n",(0,o.kt)("inlineCode",{parentName:"p"},"DevTools")," is a component that displayed in web application.\nSecond is the intrument method that is served in ",(0,o.kt)("inlineCode",{parentName:"p"},"DevTools"),".\nThis method return enhancer to use redux store. As it will follow, connect web application and redux-devtools through these two."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Inject enhancer in store & Render ",(0,o.kt)("inlineCode",{parentName:"li"},"DevTools"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// Store.ts\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport DevTools from './DevTools';\n\nconst enhancer = compose(\n  // Middleware you want to use in development:\n  applyMiddleware(d1, d2, d3),\n  // Required! Enable Redux DevTools with the monitors you chose\n  DevTools.instrument()\n);\nconst store = createStore(rootReducer, initialState, enhancer);\n\nexport default store;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// App.tsx\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\n\nrender(\n  <Provider store={store}>\n    <div>\n      <TodoApp />\n      <DevTools />\n    </div>\n  </Provider>\ndocument.getElementById('app')\n);\n")),(0,o.kt)("p",null,"The above code is the example of the part used for store enhancer and component the created ",(0,o.kt)("inlineCode",{parentName:"p"},"DevTools"),". "),(0,o.kt)("p",null,"Now, we can figure out what to check to see the contents of redux-devtools.",(0,o.kt)("br",null),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," is connected to web applications in the form of component and redux store enhancer, and we can check the inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"@redux-devtools/core"),"."),(0,o.kt)("p",null,"In here, We will check only ",(0,o.kt)("inlineCode",{parentName:"p"},"@redux-devtools/core")," in this article\nbecause  ",(0,o.kt)("inlineCode",{parentName:"p"},"DockMonitor")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"LogMonitor")," is an additional function to display redux-devtools inside of web applictions."),(0,o.kt)("h3",{id:"recap-about-devtools-connection-with-web-application"},"Recap about devtools connection with web application"),(0,o.kt)("p",null,"The link between ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"web application")," was able to get hints through a ","[manual usage]",")(",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/main/docs/Walkthrough.md#manual-integration"},"https://github.com/reduxjs/redux-devtools/blob/main/docs/Walkthrough.md#manual-integration"),") rather than a usage using browser extension. "),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"@redux-devtools/core")," is serving ",(0,o.kt)("inlineCode",{parentName:"p"},"createDevTools")," function and it provides a component that renders devtools, while at the same time creating an enhancer to inject redux store."),(0,o.kt)("p",null,"Now we can find hint, we will check about ",(0,o.kt)("inlineCode",{parentName:"p"},"createDevTools")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"@redux-devtools/core"),"."),(0,o.kt)("h2",{id:"createdevtools"},"createDevTools"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools/src/createDevTools.js#L24"},"createDevTools")," has component to render ",(0,o.kt)("inlineCode",{parentName:"p"},"DevTools")," and method to create enhancer in registered redux store.\nWe will check about enhancer."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import instrument from 'redux-devtools-instrument';\n\n// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools/src/createDevTools.js#L24\nexport default function createDevTools(children) {\n  const Monitor = monitorElement.type;\n  ...\n  return class DevTools extends Component {\n    static instrument = options => instrument(\n      (state, action) => Monitor.update(monitorProps, state, action),\n      options,\n    )\n    \n    render() {\n      ...\n    }\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"createDevTools ")," serve ",(0,o.kt)("inlineCode",{parentName:"p"},"instrument")," as a static function and it is ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L737"},"redux-devtools-instrument")),(0,o.kt)("h2",{id:"redux-enhancer"},"redux enhancer"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"DevTools.instrument()")," is used in store enhancer. So, we can expect that ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L737"},"instrument")," is return enhancer function.\nBefore we study ",(0,o.kt)("inlineCode",{parentName:"p"},"instrument"),", Let's recap about redux enhancer."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://redux.js.org/usage/configuring-your-store#enhancersmonitorreducerjs"},"redux store enhancer")," form is below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://redux.js.org/usage/configuring-your-store#enhancersmonitorreducerjs\nconst exampleEnhancer = (createStore) => (reducer, initialState, enhancer) => {\n  const monitorReducer = (state, action) => {\n    const start = performance.now()\n    const newState = reducer(state, action)\n    const end = performance.now()\n    const diff = round(end - start)\n\n    console.log('reducer process time:', diff)\n\n    return newState\n  }\n  \n  return createStore(monitorReducer, initialState, enhancer) \n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"enhnacer")," get ",(0,o.kt)("inlineCode",{parentName:"p"},"createStore")," parameter and return function that return store.",(0,o.kt)("br",{parentName:"p"}),"\n","Above code is a example of redux document, It have a role that make ",(0,o.kt)("inlineCode",{parentName:"p"},"monitorReducer")," and replace existing reducer."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"enhancer")," mutate reducer or state in this method. ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," also use the redux enhancer features to implement logging, rollback and skip features."),(0,o.kt)("h2",{id:"instrument"},"instrument"),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L737"},"instrument")," returns the redux enhancer\nand the internal structure is as follows."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L737-L771\nexport default function instrument(monitorReducer, options) {\n  return (createStore) => (reducer, initialState, enhancer) => {\n    function liftReducer(r) {\n      return liftReducerWith(r, initialState, monitorReducer, options);\n    }\n  }\n  \n  const liftedStore = createStore(liftReudcer(reducer), enhancer);\n  \n  return unliftStore(liftedStore, liftReducer, options);\n}\n")),(0,o.kt)("p",null,"Now, it returns result of ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," function and reducer is processed through ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),"."),(0,o.kt)("p",null,"To give you an additional explanation to make it easier to understand,\n",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," create another store of devtools separately from the store of app.\nIn other words, the app creates and uses a redux store, but devtools creates and uses a redux store different from the app.\nThe words ",(0,o.kt)("inlineCode",{parentName:"p"},"lift")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"unlift")," are used for these two distinction, as can be seen in the function name used in ",(0,o.kt)("inlineCode",{parentName:"p"},"instrument"),"."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"lift")," means raising app information to devtools. And ",(0,o.kt)("inlineCode",{parentName:"p"},"unlift")," means pulling down devtools information so that it can be used on the app.\nTo infer the role of ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," based on this assumption,\n",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," is reducer used in devtools and ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedStore")," means that it is store used in devtools.\nIn contrast, ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," can be understood as meaning that create a store used in the app using ",(0,o.kt)("inlineCode",{parentName:"p"},"liftStore")," that used in devtools. "),(0,o.kt)("p",null,"Of course, it is not an official expression found in the devtools document, but I brought it\nbecause I thought it would be good to understand devtools in this way. "),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"TIP")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," is separated with app's store and devtools's store.",(0,o.kt)("br",null),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"lift")," means replacing what is app with that of devtools and ",(0,o.kt)("inlineCode",{parentName:"p"},"unlift")," means replacing what is devtools that of app."),(0,o.kt)("p",{parentName:"div"},"For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," is function that get store of app using ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedStore"),"(store of devtools)."),(0,o.kt)("p",{parentName:"div"},"It is not official commentary, if you check the code of redux-devtools with this meaning, it will be easier to understand."))),(0,o.kt)("h2",{id:"unliftstore"},"unliftStore"),(0,o.kt)("p",null,"Let's see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L680-L732"},"unliftStore")," used in return of ",(0,o.kt)("inlineCode",{parentName:"p"},"instrument")," first.\n",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," is a function that create store used in app."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L680-L732\nexport function unliftStore(liftedStore, liftReducer, options) {\n  function getState() { ... }\n  function dispatch() { ... }\n  \n  return {\n    ...liftedStore,\n    liftedStore,\n    dispatch,\n    getState,\n    replaceReducer() { ... },\n    [$$observable]() { ... },\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," has several methods such as dispatch, getState, replaceReducer and the method names are familiar for us.",(0,o.kt)("br",{parentName:"p"}),"\n","Because these is served method by redux.\nIn other word, ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," doesn't use ",(0,o.kt)("inlineCode",{parentName:"p"},"createStore")," but it returns store of redux.\nBecause ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," is used for redux store enhancer and the return value of redux store,\nIt may be natural that the return value of ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," is the same as the redux store"),(0,o.kt)("h3",{id:"getstate"},"getState"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"getState")," of redux store has a role to return state object of redux store.\n",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," of return value of ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," is used in app part rather than devtools.\nSo, we can expect that ",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," will return state of redux store on app.\nLet's take a look at the code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L685-L691\nfunction getState() {\n  return unliftState(liftedStore.getState());\n  if (state !== undefined) {\n    lastDefinedState = state;\n  }\n  return lastDefinedState;\n}\n\n// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L671-L674\nfunction unliftState(liftedState) {\n  const { computedStates, currentStateIndex } = liftedState;\n  const { state } = computedStates[currentStateIndex];\n  \n  return state;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"getState")," calls ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")," returns state.\nIf we think means of ",(0,o.kt)("inlineCode",{parentName:"p"},"lift")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"unlift"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")," means state used on app.\nSo, ",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," returns ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState"),"(app's redux state) from state of ",(0,o.kt)("inlineCode",{parentName:"p"},"liftStore"),"(devtools's store). "),(0,o.kt)("p",null,"Inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState"),", it extract state using ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedState"),".\nIn other words, we can expect when data is saved, ",(0,o.kt)("inlineCode",{parentName:"p"},"liftState")," saves all app state in ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," and saves index of state in ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex"),".",(0,o.kt)("br",{parentName:"p"}),"\n","Of course, we can't know how to make ",(0,o.kt)("inlineCode",{parentName:"p"},"liftState")," yet. Let's guess this much and keep reading."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")," is a function that returns ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedState"),".",(0,o.kt)("br",null),"\nLet's remember that we don't know that ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedState")," has what kind of data,\nbut ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedState")," are looking for the state of the app through ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex"),"."))),(0,o.kt)("h3",{id:"dispatch"},"dispatch"),(0,o.kt)("p",null,"This ",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch")," is also dispatch used in app. Let's take a look some code. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L693-L696\nfunction dispatch(action) {\n  liftedStore.dispatch(liftAction(action, trace, traceLimit, dispatch))\n\n  return action;\n}\n\n// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L246-L253\nfunction liftAction(action, trace, traceLimit, toExcludeFromTrace) {\n  return ActionCreators.performAction(\n    action,\n    trace,\n    traceLimit,\n    toExcludeFromTrace\n  );\n}\n")),(0,o.kt)("p",null,"The action from parameter of ",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch")," is the action object defined in app because the method of ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," will be use directly in app. It is not exception about ",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch"),".\nSo, ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedStore"),"(devtools's store) transfer action from app to use dispatch, but action is not transmitted directly, it is converted by ",(0,o.kt)("inlineCode",{parentName:"p"},"liftAction")," and it will change action of app to action of devtools.",(0,o.kt)("br",{parentName:"p"}),"\n","Let's see inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"liftAction"),".\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L38-L97"},"ActionCreators.performAction")," is an action object having an action type as ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION"),".\nSo, all actions that dispatched in app, are converted to ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," and used in ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedStore"),"."),(0,o.kt)("p",null,"Let's think about flow included ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," when we dispatch actions."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"action")," is dispatched from app."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"dispatch")," convert ",(0,o.kt)("inlineCode",{parentName:"li"},"action")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"liftedAction")," inside."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"liftedAction")," is called through ",(0,o.kt)("inlineCode",{parentName:"li"},"liftedStore.dispatch")," and consumed in ",(0,o.kt)("inlineCode",{parentName:"li"},"liftedStore"),".")),(0,o.kt)("p",null,"In this flow doesn't have flow to call dispatch of app.\nThe process of updating the state by handling over the action to the reducer, which is the role of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux/blob/master/src/createStore.ts#L257-L262"},"original dispatch"),", was not included.\nTherefore, the dispatch has a role that converts action of app to ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," and calls dispatch of the ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedStore")," without changing the state of the app."),(0,o.kt)("h3",{id:"recap-about-unliftstore"},"Recap about unliftStore"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"unliftStore")," returns the store form as it is. In other words, it returns ",(0,o.kt)("inlineCode",{parentName:"li"},"getState")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"dispatch"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"unliftStore.getState")," returns redux state of app and it is identifying the state of the app using ",(0,o.kt)("inlineCode",{parentName:"li"},"computedStates")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"currentStateIndex")," of ",(0,o.kt)("inlineCode",{parentName:"li"},"liftedState")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"unliftStore.dispatch")," changes all actions to ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION")," and calls ",(0,o.kt)("inlineCode",{parentName:"li"},"liftedStore.dispatch"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The operation of updating the state of the app of the original dispatch has not yet been performed.")))),(0,o.kt)("h2",{id:"liftreducer"},"liftReducer"),(0,o.kt)("p",null,"Let's take a look ",(0,o.kt)("inlineCode",{parentName:"p"},"instrument")," code again."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L737-L771\nexport default function instrument(monitorReducer, options) {\n  return (createStore) => (reducer, initialState, enhancer) => {\n    function liftReducer(r) {\n      return liftReducerWith(r, initialState, monitorReducer, options);\n    }\n  }\n  \n  const liftedStore = createStore(liftReudcer(reducer), enhancer);\n  \n  return unliftStore(liftedStore, liftReducer, options);\n}\n")),(0,o.kt)("p",null,"Through the previous process, we could understand that ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore")," has a role to use new method like ",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch")," by redefine.",(0,o.kt)("br",null),"\nThe next thing to look at is ",(0,o.kt)("inlineCode",{parentName:"p"},"liftStore")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),". ",(0,o.kt)("inlineCode",{parentName:"p"},"createStore")," used in ",(0,o.kt)("inlineCode",{parentName:"p"},"liftStore")," is served by ",(0,o.kt)("inlineCode",{parentName:"p"},"redux"),"\nso if only ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," is confirmed, we can know that the secret of time-travel debugging."),(0,o.kt)("p",null,"According to the term ",(0,o.kt)("inlineCode",{parentName:"p"},"lift"),", ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L258-L666"},"liftReducer")," means\nthat reducer used in ",(0,o.kt)("inlineCode",{parentName:"p"},"devtools"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L258-L666\nexport function liftReducerWith(reducer, initialCommittedState, monitorReducer, options) {\n  const initialLiftedState = { ... };\n  ...\n  return (liftedState, liftedAction) => {\n    ...\n    switch (liftedAction.type) {\n      case ActionTypes.PERFORM_ACTION: {\n        ...\n      },\n      ...\n    }\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"liftReducerWith")," has long size of code. According to the term ",(0,o.kt)("inlineCode",{parentName:"p"},"reducer"),", it has initial state(",(0,o.kt)("inlineCode",{parentName:"p"},"initialLiftedState"),") and makes condition state by ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedAction.type"),".\nBecause we saw ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore"),", we know that all actions from app are converted to ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," and are transmitted to ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),"."),(0,o.kt)("p",null,"Therefore, we will check the initialState of reducer and check the behavior when ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACION")," is dispatched. "),(0,o.kt)("h3",{id:"initialstate"},"initialState"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"initialState")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," is below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L264-L275\nconst initialLiftedState = {\n  monitorState: monitorReducer(undefined, {}),\n  nextActionId: 1,\n  actionsById: { 0: liftAction(INIT_ACTION) },\n  stagedActionIds: [0],\n  skippedActionIds: [],\n  committedState: initialCommittedState,\n  currentStateIndex: 0,\n  computedStates: [],\n  isLocked: options.shouldStartLocked === true,\n  isPaused: options.shouldRecordChanges === false\n};\n")),(0,o.kt)("p",null,"We don't know what data is saved roughly by looking at the ",(0,o.kt)("inlineCode",{parentName:"p"},"initialState"),", but we've checked which one of the ",(0,o.kt)("inlineCode",{parentName:"p"},"liftState")," is used in ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState"),". "),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"What mentioned in ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")),(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"In other words, we can expect when data is saved, ",(0,o.kt)("inlineCode",{parentName:"li"},"liftState")," saves all app state in ",(0,o.kt)("inlineCode",{parentName:"li"},"computedStates")," and saves index of state in ",(0,o.kt)("inlineCode",{parentName:"li"},"currentStateIndex"),".")))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"unliftState")," computed using ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex"),",\nSo ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," save data of app's state and ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," save index about current state index."),(0,o.kt)("p",null,"When looking at other predictable states, ",(0,o.kt)("inlineCode",{parentName:"p"},"actionId")," seems to store action data on id and ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"skippedActionIds")," seems that save actionId about action status like ",(0,o.kt)("inlineCode",{parentName:"p"},"staged")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"skipped"),".\n",(0,o.kt)("inlineCode",{parentName:"p"},"isLocked")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"isPaused")," is option about devtools. First of all, let's just organize the contents below and move on."),(0,o.kt)("h4",{id:"recap-about-initialstate"},"recap about initialState"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"devtools saves byId and id forms about action data to ",(0,o.kt)("a",{parentName:"li",href:"https://redux.js.org/usage/structuring-reducers/normalizing-state-shape"},"normalized")," form.   "),(0,o.kt)("li",{parentName:"ul"},"we expect that ",(0,o.kt)("inlineCode",{parentName:"li"},"computedStates")," saves all state and ",(0,o.kt)("inlineCode",{parentName:"li"},"currentStateIndex")," seems that save index what kind of state is used in ",(0,o.kt)("inlineCode",{parentName:"li"},"computedStates"),".  "),(0,o.kt)("li",{parentName:"ul"},"devtools has options value like ",(0,o.kt)("inlineCode",{parentName:"li"},"isLocked")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"isPaused"),".")),(0,o.kt)("h3",{id:"the-behavior-of-perform_action"},"The behavior of PERFORM_ACTION"),(0,o.kt)("p",null,"We checked that all action dispatched in app is converted ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," and is used in ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),".\nSo, Let's check how ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," will operate in the ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),"."),(0,o.kt)("p",null,"Before see the reducer, Let's check payload of ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L38-L97\nexport const ActionCreators = {\n  performAction(action, trace, traceLimit, toExcludeFromTrace) {\n    ...\n    return {\n      type: ActionTypes.PERFORM_ACTION,\n      action,\n      timestamp: Date.now(),\n      stack,\n    }\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," stores the action received as a factor as it is and doesn't particularly store other data.\nIf you see the code following links, you can see complicate logic like ",(0,o.kt)("inlineCode",{parentName:"p"},"stack"),".\nThis is because devtools has various logics to show the trace function. But our purpose is not to look at trace, it will be okay pass lightly."),(0,o.kt)("p",null,"Not that we have seen the form of action, let's look at the reducer part."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L426-L446\nexport function liftReducerWith() {\n  ...\n  let minInvalidatedStateIndex = 0;\n  ...\n  swtich (liftedAction.type) {\n    case ActionTypes.PERFORM_ACTION: {\n      ...\n      if (currentStateIndex === stagedActionIds.length - 1) {\n        currentStateIndex++;\n      }\n      const actionId = nextActionId++;\n      actionById[actionId] = liftedAction;\n      stagedActionIds = [...stagedActionIds, actionId];\n      minInvalidatedStateIndex = stagedActionIds.length - 1;\n      break;\n    }\n    ...\n  }\n}\n")),(0,o.kt)("p",null,"When looking at the original code, the logic varies depending on the various conditions, but when you check the basic logic, it comes out simply as above.",(0,o.kt)("br",null),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," is increased, ",(0,o.kt)("inlineCode",{parentName:"p"},"actionId")," is set, ",(0,o.kt)("inlineCode",{parentName:"p"},"actionById")," save action data. And ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," come and ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," also come.\nObviously, ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," is a value that existed in ",(0,o.kt)("inlineCode",{parentName:"p"},"initialState")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," is not stored in ",(0,o.kt)("inlineCode",{parentName:"p"},"initialState")," but a local variable.\nwe don't know how to use these yet, so let's move on."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"TIP")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"we don't know how to work about ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex"),". However, to explain the role in advance to make it easier to understand, it is as follows. "),(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"stagedActionIds"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"It is array that ids of the action that should be apply in devtools are saved."),(0,o.kt)("li",{parentName:"ul"},"In other words, it save valid action list and when ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION")," is dispatched, ",(0,o.kt)("inlineCode",{parentName:"li"},"stagedActionIds")," always add it because new action is added."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"In short, ",(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex")," means the index value of the action that must be recalculated."),(0,o.kt)("li",{parentName:"ul"},"In ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex")," is  ",(0,o.kt)("inlineCode",{parentName:"li"},"stagedActionIdex.length - 1"),". In other words, ",(0,o.kt)("inlineCode",{parentName:"li"},"stagedActionIndex")," point last index of actions and it means that last action need to recalculate.  ")))))),(0,o.kt)("p",null,"We checked how to implement when action is dispatched, we don't know how to calculated nextState yet.\nObviously, it saved action info and saved action id here and there but, we can't expect that info calculate nextState.\nLet's show next logic of switch."),(0,o.kt)("h3",{id:"recap-about-logic-of-perform_action"},"Recap about logic of PERFORM_ACTION"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION")," brings all the data of the action generated in the app as it is."),(0,o.kt)("li",{parentName:"ul"},"all actions that dispatched from app are converted to ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION"),". So it are performed through a ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION")," reducer logic.  "),(0,o.kt)("li",{parentName:"ul"},"In reducer, it increases ",(0,o.kt)("inlineCode",{parentName:"li"},"currentStateIndex"),", save action like byId and ids form and save ",(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex"),". "),(0,o.kt)("li",{parentName:"ul"},"The logic to calculate ",(0,o.kt)("inlineCode",{parentName:"li"},"nextState")," is not come yet."),(0,o.kt)("li",{parentName:"ul"},"We don't know means that ",(0,o.kt)("inlineCode",{parentName:"li"},"stagedActionIds")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex"),", but if we know it in advance, it's as follows.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"stagedActionIds"),": A array that saved ids that need to apply actions in devtools."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex"),": A index of action to calculate state. Later, it calculate use this value.")))),(0,o.kt)("h2",{id:"recomputestates"},"recomputeStates"),(0,o.kt)("p",null,"After switch logic, ",(0,o.kt)("inlineCode",{parentName:"p"},"computedState")," logic is come. It seems that update state using ",(0,o.kt)("inlineCode",{parentName:"p"},"recomputeStates"),", Let's look at."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L642-L666\nexport function liftReducerWith() {\n  ...\n  computedStates = recomputeStates(\n    computedStates,\n    minInvalidatedStateIndex,\n    reducer,\n    committedState,\n    actionsById,\n    stagedActionIds,\n    skippedActionIds,\n    options.shouldCatchErrors\n  );\n  \n  return {\n    monitorState,\n    actionsById,\n    nextActionId,\n    stagedActionIds,\n    skippedActionIds,\n    committedState,\n    currentStateIndex,\n    computedStates,\n    isLocked,\n    isPaused\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"recomputeStates")," is function that recalculate state when action is dispatched.\nIn parameters, It seems that gets various information like ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),"(currentState), ",(0,o.kt)("inlineCode",{parentName:"p"},"reducer"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"actionByIds")," etc.\nLet's look at the code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L189-L241\nfunction recomputeStates(\n  computedStates,\n  minInvalidatedStateIndex,\n  reducer,\n  committedState,\n  actionsById,\n  stagedActionIds,\n  skippedActionIds,\n  shouldCatchErrors\n) {\n  const nextComputedStates = computedStates.slice(0, minInvalidatedStateIndex);\n  \n  for (let i = minInvalidatedStateIndex; i < stagedActionIds.length; i++) {\n    const actionId = stagedActionIds[i];\n    const action = actionsById[actionId].action;\n\n    const previousEntry = nextComputedStates[i - 1];\n    const previousState = previousEntry ? previousEntry.state : committedState;\n\n    const entry = computeNextEntry(\n      reducer,\n      action,\n      previousState,\n      shouldCatchErrors\n    );\n    nextComputedStates.push(entry);\n  }\n\n  return nextComputedStates;\n}\n")),(0,o.kt)("p",null,"After omitting the code for skip or error processing, it becomes the above code.\nInitially, ",(0,o.kt)("inlineCode",{parentName:"p"},"nextComputedStates")," is prepared and the state up to ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," is cut.\nHere, the meaning of ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," may be known."),(0,o.kt)("p",null,"The value of ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," calculated in ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," earlier refers to the index that has recently entered ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds"),".\nFor example, If ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," has four ids, ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," is three and nextComputedStates",(0,o.kt)("inlineCode",{parentName:"p"},"is a array thet three number of value because it save 0 to 3. \nIn"),"for",(0,o.kt)("inlineCode",{parentName:"p"},"loop, it start calculate from"),"minInvalidatedStateIndex",(0,o.kt)("inlineCode",{parentName:"p"},"and to"),"stagedActionIds.length",(0,o.kt)("inlineCode",{parentName:"p"},".\nIn other words, "),"minInvalidatedStateIndex` means index of action that need to recalculate.   "),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"for")," loop logic is simple. Find out id of the current action and take the action from ",(0,o.kt)("inlineCode",{parentName:"p"},"actionById"),", and state is calculated using ",(0,o.kt)("inlineCode",{parentName:"p"},"computeNextEntry")," function.\n",(0,o.kt)("inlineCode",{parentName:"p"},"computeNextEntry")," logic is simple. It consists of several functions because it contains logic for errors, and the code related to errors is omitted as follows."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L179-L184\nfunction computeNextEntry(reducer, action, state, shouldCatchErrors) {\n  ...\n  return computeWithTryCatch(reducer, action, state);\n} \n\n// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L153-L174\nfunction computeWithTryCatch(reducer, action, state) {\n  let nextError;\n  const nextState = reducer(state, action);\n  ...\n  return {\n    state: nextState,\n    error: nextError,\n  }\n}\n")),(0,o.kt)("p",null,"In other words, It calculates next state using previous state, current action and reducer.\nThis calculated value is entered entry and this entry is injected the last of ",(0,o.kt)("inlineCode",{parentName:"p"},"nextComputedStates"),". "),(0,o.kt)("p",null,"When ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," action is dispatched, for loop always work once and calculated state newly is contained ",(0,o.kt)("inlineCode",{parentName:"p"},"nextComputedStates")," array. It will be assign to ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),".\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," changed here is transmitted to state of app."),(0,o.kt)("h3",{id:"recap-about-recomputestates"},"Recap about recomputeStates"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The logic to update state of store in devtools is ",(0,o.kt)("inlineCode",{parentName:"li"},"recomputeStates")," logic in next part of switch."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"recomputeStates")," prepares computed state array and computes new state through the for loop based on the index that needs to be calculated and places it in the state array."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"minInvalidatedStateIndex")," refers to a start index that requires calculation."),(0,o.kt)("li",{parentName:"ul"},"When ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION")," is dispatched, for loop run only once and the state of current action is appended in previous ",(0,o.kt)("inlineCode",{parentName:"li"},"computedStates"),".")),(0,o.kt)("h2",{id:"the-process-that-action-is-consumed-with-devtools"},"The process that action is consumed with devtools"),(0,o.kt)("p",null,"Now we can see how devtools processes an action when an action occurs in the app."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"action is called with dispatch on app")),(0,o.kt)("p",null,"The dispatch used when dispatched action in app is ",(0,o.kt)("a",{parentName:"p",href:"#dispatch"},"dispatch")," of ",(0,o.kt)("a",{parentName:"p",href:"#unliftstore"},"unliftStore"),".\ndispatch call dispatch of ",(0,o.kt)("inlineCode",{parentName:"p"},"liftStore")," and action is called with converting ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"liftReducer")," of ",(0,o.kt)("inlineCode",{parentName:"li"},"liftStore"))),(0,o.kt)("p",null,"Action is called to ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION"),", and it is consumed at ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),". If you see ",(0,o.kt)("a",{parentName:"p",href:"#the-behavior-of-perform_action"},"The behavior of PERFORM_ACTION"),",\nit increases 1 about ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex"),", saves action info with generating action id and injects actionId in ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," and updates ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex"),"."),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"recomputedStates")," a new state is calculated based on ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex"),", and in ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION"),", only the action called this time is calculated.\nHere, the calculated state is added to the last array of ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"get state from app to ",(0,o.kt)("inlineCode",{parentName:"li"},"getState"))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"store.getState")," to get state from app is same with ",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch"),". It also use ",(0,o.kt)("a",{parentName:"p",href:"#getstate"},"getState")," of ",(0,o.kt)("a",{parentName:"p",href:"#unliftstore"},"unliftStore"),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," calculate state to using ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"liftedState"),"."),(0,o.kt)("p",null,"If only ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," was dispatched, ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," would have increased by 1 and the return value of ",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," would have brought the state in the last index of ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),". "),(0,o.kt)("h2",{id:"analysis-of-the-main-behaviour-of-devtools"},"Analysis of the main behaviour of devtools"),(0,o.kt)("p",null,"We checked that action is processed in devtools, so it is now possible to answer the questions presented at the beginning of the article."),(0,o.kt)("h3",{id:"how-to-log-the-actions-and-reducer-called-in-redux-devtools"},"How to log the actions and reducer called in redux-devtools?"),(0,o.kt)("p",null,"About logging, it can be derived using the information identified so far. "),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Question & Answer")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("blockquote",{parentName:"div"},(0,o.kt)("p",{parentName:"blockquote"},"Q1. How to ",(0,o.kt)("strong",{parentName:"p"},"log")," the actions and reducer called in redux-devtools?")),(0,o.kt)("p",{parentName:"div"},"A1. ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," save all information of action in ",(0,o.kt)("inlineCode",{parentName:"p"},"actionsById")," and save all action id in ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds"),".\nAlso, It save state by actions in ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),"."),(0,o.kt)("p",{parentName:"div"},"Therefore, since the order of actions generated in the app, payload data, and state by action are stored, the devtools can take enough logs.\nIn addition, encapsulation of information on action and state managed by devtools is maintained through getState of ",(0,o.kt)("inlineCode",{parentName:"p"},"unliftStore"),".\nIn the app, you can proceed with development without understanding these matters."))),(0,o.kt)("h3",{id:"how-to-jump-to-a-point-where-specific-aciton-is-dispatched-in-redux-devtools"},"How to ",(0,o.kt)("strong",{parentName:"h3"},"jump")," to a point where specific aciton is dispatched in redux-devtools."),(0,o.kt)("p",null,"There is something we need to look at in order to know how to jump in redux-devtools.\nWe only looked at ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer"),". All action that dispatched in app is converted to ",(0,o.kt)("inlineCode",{parentName:"p"},"PERFORM_ACTION"),",\nbut the action dispatched in ",(0,o.kt)("inlineCode",{parentName:"p"},"devtools")," can dispatch other type of action."),(0,o.kt)("p",null,"Let's look at how ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," handles jump related actions."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L511-#L526\ncase ActionTypes.JUMP_TO_STATE: {\n  currentStateIndex = liftedAction.index;\n  minInvalidatedStateIndex = Infinity;\n  break;\n}\ncase ActionTypes.JUMP_TO_ACTION: {\n  const index = stagedActionIds.indexOf(liftedAction.actionId);\n  if (index !== -1) currentStateIndex = index;\n  minInvalidatedStateIndex = Infinity;\n  break;\n}\n")),(0,o.kt)("p",null,"This is the part that processes the action in ",(0,o.kt)("inlineCode",{parentName:"p"},"liftReducer")," that we have seen before."),(0,o.kt)("p",null,"There will be a difference between calling based on state or action, but both have the same principle.\nIt is to allocate ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," as the index of the action to jump."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"getState")," brings state from ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," based on updated ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex"),".\nFor example, ",(0,o.kt)("inlineCode",{parentName:"p"},"computedState")," has 5 state and ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," is set 4 then ",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," will return last state of ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),".\nIn this time, we suppose that currentStateIndex will be changed to 2 by ",(0,o.kt)("inlineCode",{parentName:"p"},"JUMP_TO_STATE")," action. Then ",(0,o.kt)("inlineCode",{parentName:"p"},"getState")," will return 3 index of ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates"),"\nand store of app back to the state when third action was dispatched."),(0,o.kt)("p",null,"Since ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," is not mutated, if you come back to ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," using ",(0,o.kt)("inlineCode",{parentName:"p"},"JUMP_TO_STATE")," action, we can come back to original state."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Question & Answer")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("blockquote",{parentName:"div"},(0,o.kt)("p",{parentName:"blockquote"},"Q2. How to ",(0,o.kt)("strong",{parentName:"p"},"jump")," to a point where specific aciton is dispatched in redux-devtools.")),(0,o.kt)("p",{parentName:"div"},"A2. Through the action generated inside devtools, ",(0,o.kt)("inlineCode",{parentName:"p"},"currentStateIndex")," is returned to the previous value\nand the state suitable for the index is imported, so it is possible to return to the previous state.\nIn this process, since data on ",(0,o.kt)("inlineCode",{parentName:"p"},"computedStates")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"stagedActionIds")," storing action or state is not changed, the state before jump may return through action.  "))),(0,o.kt)("h3",{id:"how-to-skip-a-specific-action-as-if-it-did-not-work-in-redux-devtools"},"How to ",(0,o.kt)("strong",{parentName:"h3"},"skip")," a specific action as if it did not work in redux-devtools"),(0,o.kt)("p",null,"A method to skip as if no action had already occurred confirms ",(0,o.kt)("inlineCode",{parentName:"p"},"TOGGLE_ACTION"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L481-L494\ncase ActionTypes.TOGGLE_ACTION: {\n  // Toggle whether an action with given ID is skipped.\n  // Being skipped means it is a no-op during the computation.\n  const { id: actionId } = liftedAction;\n  const index = skippedActionIds.indexOf(actionId);\n  if (index === -1) {\n    skippedActionIds = [actionId, ...skippedActionIds];\n  } else {\n    skippedActionIds = skippedActionIds.filter(id => id !== actionId);\n  }\n  // Optimization: we know history before this action hasn't changed\n  minInvalidatedStateIndex = stagedActionIds.indexOf(actionId);\n  break;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"TOGGLE_ACTION")," also get target actionId and save it on ",(0,o.kt)("inlineCode",{parentName:"p"},"skippedActionIds")," and change ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," to index of actionId.\nThen state that after index of skipped action will be calculated again."),(0,o.kt)("p",null,"Since we didn't focus on logic about skipped action, I have never checked where ",(0,o.kt)("inlineCode",{parentName:"p"},"skippedActionIds")," works.\nSo, we will check ",(0,o.kt)("inlineCode",{parentName:"p"},"recomputeState")," again."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-instrument/src/instrument.js#L218-L222\nfunction recomputeStates(\n  computedStates,\n  minInvalidatedStateIndex,\n  reducer,\n  committedState,\n  actionsById,\n  stagedActionIds,\n  skippedActionIds,\n  shouldCatchErrors\n) {\n  ...\n  const nextComputedStates = computedStates.slice(0, minInvalidatedStateIndex);\n  for (let i = minInvalidatedStateIndex; i < stagedActionIds.length; i++) {\n    const actionId = stagedActionIds[i];\n    const action = actionsById[actionId].action;\n\n    const previousEntry = nextComputedStates[i - 1];\n    const previousState = previousEntry ? previousEntry.state : committedState;\n\n    const shouldSkip = skippedActionIds.indexOf(actionId) > -1;\n    let entry;\n    if (shouldSkip) {\n      entry = previousEntry;\n    } else {\n      ...\n    }\n    nextComputedStates.push(entry);\n  }\n\n  return nextComputedStates;\n}\n")),(0,o.kt)("p",null,"This time, I omitted the logic except skip. It is same entered for loop, if ",(0,o.kt)("inlineCode",{parentName:"p"},"actionId")," is contained ",(0,o.kt)("inlineCode",{parentName:"p"},"skippedActionIds"),", entry doesn't calculate next state\nand return ",(0,o.kt)("inlineCode",{parentName:"p"},"previousEntry")," like action doesn't act.   "),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"TOGGLE_ACTION"),", since action updates ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex")," to target actionId, states after target index are recalculated\nso it is possible to set the app as if a specific action did not work."),(0,o.kt)("p",null,"Based on the state, it is summarized as follows."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"previous state: ","[A, B, C, D, E, ...]"),(0,o.kt)("li",{parentName:"ul"},"skipped action index: 2"),(0,o.kt)("li",{parentName:"ul"},"after skip state: ","[A, B, B, D', E' ...]")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Question & Answer")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("blockquote",{parentName:"div"},(0,o.kt)("p",{parentName:"blockquote"},"Q3. How to ",(0,o.kt)("strong",{parentName:"p"},"skip")," a specific action as if it did not work in redux-devtools")),(0,o.kt)("p",{parentName:"div"},"A2. actionId is put into ",(0,o.kt)("inlineCode",{parentName:"p"},"skippedActionIds")," through an action generated inside devtools.\nWhen calculating the state for the action included in ",(0,o.kt)("inlineCode",{parentName:"p"},"skippedActionIds"),", return the previous state without calculating the state. "),(0,o.kt)("p",{parentName:"div"},"Since ",(0,o.kt)("inlineCode",{parentName:"p"},"minInvalidatedStateIndex"),", which stores an index requiring recalculation, has been changed to a target action index,\nall states after the index are recalculated.\nSince the target action continues the calculation to the skipped state, the state is formed as if the target action was not called."))),(0,o.kt)("h2",{id:"recap"},"Recap"),(0,o.kt)("p",null,"Through this article, we checked how ",(0,o.kt)("inlineCode",{parentName:"p"},"redox-devtools")," is connected to the ",(0,o.kt)("inlineCode",{parentName:"p"},"redux")," of the app and how to manage the ",(0,o.kt)("inlineCode",{parentName:"p"},"redux")," data of the app."),(0,o.kt)("p",null,"A brief summary of the core of ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," is as follows."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"redux-devtools")," is connected to the redux store of the app through a redux store enhancer."),(0,o.kt)("li",{parentName:"ul"},"In order not to affect the app while utilizing various functions of ",(0,o.kt)("inlineCode",{parentName:"li"},"redux-devtools"),", two stores, ",(0,o.kt)("inlineCode",{parentName:"li"},"unliftStore")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"liftStore")," are managed. "),(0,o.kt)("li",{parentName:"ul"},"All actions generated in the app are converted into ",(0,o.kt)("inlineCode",{parentName:"li"},"liftAction")," having a ",(0,o.kt)("inlineCode",{parentName:"li"},"PERFORM_ACTION")," type and transmitted to ",(0,o.kt)("inlineCode",{parentName:"li"},"liftReducer"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"liftReducer")," stores data on all actions occuring in the app and state on the action."),(0,o.kt)("li",{parentName:"ul"},"The redux state used in the app is data obtained from the ",(0,o.kt)("inlineCode",{parentName:"li"},"getState")," of ",(0,o.kt)("inlineCode",{parentName:"li"},"unliftStore")," to the state suitable for the current action. "),(0,o.kt)("li",{parentName:"ul"},"Various functions used in ",(0,o.kt)("inlineCode",{parentName:"li"},"devtools")," use a method of changing action and state stored through ",(0,o.kt)("inlineCode",{parentName:"li"},"liftReducer")," and delivering the state suitable for the desired time to the app.")),(0,o.kt)("p",null,"Some of the readers of this article may be curious about functions other than ",(0,o.kt)("inlineCode",{parentName:"p"},"jump")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"skip")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools"),".\nHowever, there is a limit to explaining everything in ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools"),", and I have not checked logic for all functions either.\nIf you have understood through this article how ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-devtools")," is operating and how it is implementing its main functions (jump, skip),\nI think you can solve your curiosity by looking at the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools/src/index.js"},"@redux-devtools/core")," code\nor analyzing the code of other monitors (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-devtools/blob/v3.6.0/packages/redux-devtools-log-monitor/src/LogMonitor.js"},"@redux-devtools/log-monitors"),")."),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://redux.js.org/"},"redux")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/reduxjs/redux-devtools"},"redux-devtools")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/zalmoxisus/redux-devtools-extension"},"redux-devtools-extensions"))))}m.isMDXComponent=!0}}]);