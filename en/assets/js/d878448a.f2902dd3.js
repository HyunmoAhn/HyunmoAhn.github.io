"use strict";(self.webpackChunkhyunmoahn_github_io=self.webpackChunkhyunmoahn_github_io||[]).push([[907],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return c}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=m(e,["components","mdxType","originalType","parentName"]),u=l(n),c=i,h=u["".concat(s,".").concat(c)]||u[c]||p[c]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var m={};for(var s in t)hasOwnProperty.call(t,s)&&(m[s]=t[s]);m.originalType=e,m.mdxType="string"==typeof e?e:i,o[1]=m;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9356:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return m},contentTitle:function(){return s},metadata:function(){return l},assets:function(){return d},toc:function(){return p},default:function(){return c}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],m={slug:"deep-dive-to-immer",title:"Deep dive to immer",description:"immer, usually used by redux, help us to update mutable object like using immutably. How can it do this? Lets deep dive to immer.",keywords:["redux","redux-toolkit","immer","immutable","javascript","deep-dive","how-to-work","web"],authors:"HyunmoAhn",tags:["redux","redux-toolkit","immer","library","how-to-work","deep-dive","javascript","web","immutable"]},s=void 0,l={permalink:"/en/deep-dive-to-immer",source:"@site/i18n/en/docusaurus-plugin-content-blog/2021-10-23-deep-dive-to-immer.md",title:"Deep dive to immer",description:"immer, usually used by redux, help us to update mutable object like using immutably. How can it do this? Lets deep dive to immer.",date:"2021-10-23T00:00:00.000Z",formattedDate:"October 23, 2021",tags:[{label:"redux",permalink:"/en/tags/redux"},{label:"redux-toolkit",permalink:"/en/tags/redux-toolkit"},{label:"immer",permalink:"/en/tags/immer"},{label:"library",permalink:"/en/tags/library"},{label:"how-to-work",permalink:"/en/tags/how-to-work"},{label:"deep-dive",permalink:"/en/tags/deep-dive"},{label:"javascript",permalink:"/en/tags/javascript"},{label:"web",permalink:"/en/tags/web"},{label:"immutable",permalink:"/en/tags/immutable"}],readingTime:26.58,truncated:!0,authors:[{name:"Hyunmo Ahn",title:"Front End Engineer @ Line Financial+",url:"https://github.com/HyunmoAhn",imageURL:"https://github.com/HyunmoAhn.png",key:"HyunmoAhn"}],nextItem:{title:"how to time travel debugging at redux-devtools",permalink:"/en/how-to-time-travel-debugging-at-redux-devtools"}},d={authorsImageUrls:[void 0]},p=[{value:"What is my curious?",id:"what-is-my-curious",children:[]}],u={toc:p};function c(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This article basically takes time to learn about immer ",(0,r.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/"},"immer"),".\nIf you don't know immer, I recommend reading ",(0,r.kt)("a",{parentName:"p",href:"#what-is-immer-and-why"},"next chapter")," first."),(0,r.kt)("h2",{id:"what-is-my-curious"},"What is my curious?"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Question")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Q1. How does ",(0,r.kt)("inlineCode",{parentName:"p"},"immer")," change the mutable update way to immutable update way?"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"immer")," functions to return data immutably even when using the object built-in method that changes to be mutable.\nLet's find out how this function works internally."),(0,r.kt)("p",null,"This example is following basic example of ",(0,r.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/#a-quick-example-for-comparison"},"immer official docs")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'import produce from \'immer\';\n\nconst baseState = [\n  { \n    title: "Learn TypeScript", \n    done: true,\n  },\n  { \n    title: "Try Immer", \n    done: false,\n  },\n]\n\nconst nextState = produce(baseState, (draft) => {\n  draft.push({ title: "Tweet about It" });\n  draft[1].done = true;\n})\n\nconsole.log(baseState === nextState) // false\nconsole.log(nextState)\n/*\n[\n  { \n    title: "Learn TypeScript", \n    done: true,\n  },\n  { \n    title: "Learn TypeScript", \n    done: true,\n  },\n  { \n    title: "Tweet about It",\n  },\n]\n*/\n')),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Question")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Q2. How does ",(0,r.kt)("inlineCode",{parentName:"p"},"immer")," use ",(0,r.kt)("inlineCode",{parentName:"p"},"structural sharing"),"?"),(0,r.kt)("p",{parentName:"div"},"*",(0,r.kt)("inlineCode",{parentName:"p"},"structural sharing"),": When coping an object, the same reference is used for an object that has not been changed."))),(0,r.kt)("p",null,"To update object immutably means that original object is copied to new object. In other word, copy needs to cost.\nWhen ",(0,r.kt)("inlineCode",{parentName:"p"},"immer")," copy object, the unchanged reference copies the object using the structural sharing method that is reused.\nLet's find out what kind of structural sharing is used in ",(0,r.kt)("inlineCode",{parentName:"p"},"immer"),"."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Question")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Q3. ",(0,r.kt)("inlineCode",{parentName:"p"},"immer")," sometimes updates data through return rather than mutable updating the draft within ",(0,r.kt)("inlineCode",{parentName:"p"},"produce")," function,\nin which case the logic is different?"))),(0,r.kt)("p",null,"When using an ",(0,r.kt)("inlineCode",{parentName:"p"},"immer"),", there is a case of returning a new object instead of the mutable update method suggested above.\nThis is same as the method of returning objects from javascript immutably regardless of the immer.\n",(0,r.kt)("inlineCode",{parentName:"p"},"immer")," ",(0,r.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/return"},"officially is guiding")," this way and\nThere will be many developers who use both methods, the method of changing objects to be mutable and method of changing objects to be immutable.\nLet's see what logic differences these differences cause in the ",(0,r.kt)("inlineCode",{parentName:"p"},"immer"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'// mutable method\nconst nextState = produce(baseState, (draft) => {\n  draft.push({ title: "Tweet about It" });\n  draft[1].done = true;\n})\n\n// highlight-start\n// immutable method\nconst nextState = produce(baseState, (draft) => {\n  return {\n    ...baseState,\n    { ...baseState[1], done: true },\n    { title: "Tweet about It" },\n  }\n})\n// highlight-end\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"PREREQUISITES")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Experience using an ",(0,r.kt)("inlineCode",{parentName:"li"},"immer")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"redux-toolkit")),(0,r.kt)("li",{parentName:"ul"},"Understanding of ",(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"},"Proxy")," (optional)")))))}c.isMDXComponent=!0}}]);