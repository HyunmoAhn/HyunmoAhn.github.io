"use strict";(self.webpackChunkhyunmoahn_github_io=self.webpackChunkhyunmoahn_github_io||[]).push([[8954],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>c});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),m=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},s=function(e){var t=m(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=m(n),k=a,c=d["".concat(l,".").concat(k)]||d[k]||u[k]||i;return n?r.createElement(c,p(p({ref:t},s),{},{components:n})):r.createElement(c,p({ref:t},s))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,p=new Array(i);p[0]=k;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:a,p[1]=o;for(var m=2;m<i;m++)p[m]=n[m];return r.createElement.apply(null,p)}return r.createElement.apply(null,n)}k.displayName="MDXCreateElement"},7420:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>p,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>m});var r=n(3117),a=(n(7294),n(3905));const i={slug:"deep-dive-to-immer",title:"immer \ub0b4\ubd80 \uc0b4\ud3b4\ubcf4\uae30",description:"redux\uc5d0\uc11c \uc8fc\ub85c \uc0ac\uc6a9\ub418\ub294 immer\ub294 mutable\ud55c \uac1d\uccb4 \uc5c5\ub370\uc774\ud2b8\ub97c immutable\ud558\uac8c \uc0ac\uc6a9\ud558\ub294 \uac83 \ucc98\ub7fc \ub3c4\uc640\uc900\ub2e4. \uc5b4\ub5bb\uac8c \uc774\ub7f0 \ub85c\uc9c1\uc774 \uac00\ub2a5\ud55c\uac78\uae4c?",keywords:["redux","redux-toolkit","immer","immutable","javascript","deep-dive","how-to-work","web"],authors:"HyunmoAhn",tags:["redux","redux-toolkit","immer","library","how-to-work","deep-dive","javascript","web","immutable"]},p=void 0,o={permalink:"/deep-dive-to-immer",source:"@site/blog/2021-10-23-deep-dive-to-immer.md",title:"immer \ub0b4\ubd80 \uc0b4\ud3b4\ubcf4\uae30",description:"redux\uc5d0\uc11c \uc8fc\ub85c \uc0ac\uc6a9\ub418\ub294 immer\ub294 mutable\ud55c \uac1d\uccb4 \uc5c5\ub370\uc774\ud2b8\ub97c immutable\ud558\uac8c \uc0ac\uc6a9\ud558\ub294 \uac83 \ucc98\ub7fc \ub3c4\uc640\uc900\ub2e4. \uc5b4\ub5bb\uac8c \uc774\ub7f0 \ub85c\uc9c1\uc774 \uac00\ub2a5\ud55c\uac78\uae4c?",date:"2021-10-23T00:00:00.000Z",formattedDate:"2021\ub144 10\uc6d4 23\uc77c",tags:[{label:"redux",permalink:"/tags/redux"},{label:"redux-toolkit",permalink:"/tags/redux-toolkit"},{label:"immer",permalink:"/tags/immer"},{label:"library",permalink:"/tags/library"},{label:"how-to-work",permalink:"/tags/how-to-work"},{label:"deep-dive",permalink:"/tags/deep-dive"},{label:"javascript",permalink:"/tags/javascript"},{label:"web",permalink:"/tags/web"},{label:"immutable",permalink:"/tags/immutable"}],readingTime:44.83,hasTruncateMarker:!0,authors:[{name:"Hyunmo Ahn",title:"Front End Engineer @ Line+",url:"https://github.com/HyunmoAhn",imageURL:"https://github.com/HyunmoAhn.png",key:"HyunmoAhn"}],frontMatter:{slug:"deep-dive-to-immer",title:"immer \ub0b4\ubd80 \uc0b4\ud3b4\ubcf4\uae30",description:"redux\uc5d0\uc11c \uc8fc\ub85c \uc0ac\uc6a9\ub418\ub294 immer\ub294 mutable\ud55c \uac1d\uccb4 \uc5c5\ub370\uc774\ud2b8\ub97c immutable\ud558\uac8c \uc0ac\uc6a9\ud558\ub294 \uac83 \ucc98\ub7fc \ub3c4\uc640\uc900\ub2e4. \uc5b4\ub5bb\uac8c \uc774\ub7f0 \ub85c\uc9c1\uc774 \uac00\ub2a5\ud55c\uac78\uae4c?",keywords:["redux","redux-toolkit","immer","immutable","javascript","deep-dive","how-to-work","web"],authors:"HyunmoAhn",tags:["redux","redux-toolkit","immer","library","how-to-work","deep-dive","javascript","web","immutable"]},prevItem:{title:"Front-end\uc5d0\uc11c OAS generator\ub97c \uc5b4\ub5bb\uac8c \uc4f0\uba74 \uc88b\uc744\uae4c?",permalink:"/how-to-use-oas-generator"},nextItem:{title:"redux-devtools\uc758 time-travel-debugging \ud1ba\uc544\ubcf4\uae30",permalink:"/how-to-time-travel-debugging-at-redux-devtools"}},l={authorsImageUrls:[void 0]},m=[{value:"\ubb34\uc5c7\uc774 \uad81\uae08\ud560\uae4c?",id:"\ubb34\uc5c7\uc774-\uad81\uae08\ud560\uae4c",level:2},{value:"Immer\ub294 \ubb34\uc5c7\uc774\uace0, \uc65c \uc0ac\uc6a9\ud558\ub294\uac78\uae4c?",id:"immer\ub294-\ubb34\uc5c7\uc774\uace0-\uc65c-\uc0ac\uc6a9\ud558\ub294\uac78\uae4c",level:2},{value:"\uc0ac\uc6a9\ubc95",id:"\uc0ac\uc6a9\ubc95",level:2},{value:"deep-dive \uc804 immer\uc5d0 \ub300\ud574\uc11c",id:"deep-dive-\uc804-immer\uc5d0-\ub300\ud574\uc11c",level:2},{value:"immer\ub294 \uc6d0\ub798 \uac1d\uccb4\ub97c \ubcc0\uacbd\uc2dc\ud0a4\uc9c0 \uc54a\ub294\ub2e4.",id:"immer\ub294-\uc6d0\ub798-\uac1d\uccb4\ub97c-\ubcc0\uacbd\uc2dc\ud0a4\uc9c0-\uc54a\ub294\ub2e4",level:3},{value:"immer\ub294 \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c \uae30\ub85d\ud55c\ub2e4.",id:"immer\ub294-\uac1d\uccb4\uac00-\ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c-\uae30\ub85d\ud55c\ub2e4",level:3},{value:"Recap",id:"recap",level:3},{value:"Deep dive to immer",id:"deep-dive-to-immer",level:2},{value:"scope",id:"scope",level:3},{value:"proxy",id:"proxy",level:3},{value:"new Proxy",id:"new-proxy",level:3},{value:"Traps of immer",id:"traps-of-immer",level:3},{value:"Get",id:"get",level:4},{value:"\uc774\ubbf8 \uc0dd\uc131\ud55c proxy\uc758 \uc7ac\uc0ac\uc6a9 (<code>value === peek(state.base_, prop)</code>)",id:"\uc774\ubbf8-\uc0dd\uc131\ud55c-proxy\uc758-\uc7ac\uc0ac\uc6a9-value--peekstatebase_-prop",level:5},{value:"Set",id:"set",level:4},{value:"Recap of Proxy",id:"recap-of-proxy",level:3},{value:"finalize",id:"finalize",level:2},{value:"root proxy\ub97c \uc0ac\uc6a9\ud558\ub294 finalize",id:"root-proxy\ub97c-\uc0ac\uc6a9\ud558\ub294-finalize",level:3},{value:"recipe\uc758 return\uc744 \uc0ac\uc6a9\ud558\ub294 finalize",id:"recipe\uc758-return\uc744-\uc0ac\uc6a9\ud558\ub294-finalize",level:3},{value:"Recap",id:"recap-1",level:2},{value:"\uad81\uae08\uc99d \ud574\uc18c",id:"\uad81\uae08\uc99d-\ud574\uc18c",level:2},{value:"Reference",id:"reference",level:2}],s={toc:m},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\uc774 \uae00\uc740 \uae30\ubcf8\uc801\uc73c\ub85c ",(0,a.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/"},"immer"),"\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf4\ub294 \uc2dc\uac04\uc744 \uac00\uc9c4\ub2e4. \ub9cc\uc57d immer\ub97c \uc798 \ubaa8\ub974\ub294 \ubd84\ub4e4\uc740 ",(0,a.kt)("a",{parentName:"p",href:"#immer%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94%EA%B1%B8%EA%B9%8C"},"\uc544\ub798 \ucc55\ud130"),"\ub97c \uba3c\uc800 \uc77d\uc5b4\ubcf4\ub294 \uac83\uc744 \uad8c\uc7a5\ud55c\ub2e4."),(0,a.kt)("h2",{id:"\ubb34\uc5c7\uc774-\uad81\uae08\ud560\uae4c"},"\ubb34\uc5c7\uc774 \uad81\uae08\ud560\uae4c?"),(0,a.kt)("admonition",{title:"Question",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Q1. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\ub294 \uac1d\uccb4 mutable\ud558\uac8c \ubc14\uafb8\ub294 \ubc29\uc2dd\uc744 \uc5b4\ub5bb\uac8c immutable\ud55c \ubc29\uc2dd\uc73c\ub85c \ubc14\uafb8\uc5b4\uc8fc\uace0 \uc788\uc744\uae4c? ")),(0,a.kt)("p",null,"immer\ub294 mutable\ud558\uac8c \ubcc0\uacbd\ud558\ub294 \uac1d\uccb4 built-in method\ub97c \uc0ac\uc6a9\ud558\ub354\ub77c\ub3c4 immutable\ud558\uac8c \ub370\uc774\ud130\ub97c \ubc18\ud658\ud574\uc8fc\ub294 \uae30\ub2a5\uc744 \ud55c\ub2e4. \uc774 \uae30\ub2a5\uc774 \ub0b4\ubd80\uc801\uc73c\ub85c \uc5b4\ub5a4 \ubc29\uc2dd\uc73c\ub85c \uc774\ub8e8\uc5b4\uc9c0\ub294\uc9c0 \uc54c\uc544\ubcf8\ub2e4."),(0,a.kt)("p",null,"\uc544\ub798 \ucf54\ub4dc \uc608\uc2dc\ub294 ",(0,a.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/#a-quick-example-for-comparison"},"immer \uacf5\uc2dd \ubb38\uc11c"),"\uc5d0 \uc874\uc7ac\ud558\ub294 basic example\uc744 \uac00\uc838\uc628 \uac83\uc774\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'import produce from \'immer\';\n\nconst baseState = [\n  { \n    title: "Learn TypeScript", \n    done: true,\n  },\n  { \n    title: "Try Immer", \n    done: false,\n  },\n]\n\nconst nextState = produce(baseState, (draft) => {\n  draft.push({ title: "Tweet about It" });\n  draft[1].done = true;\n})\n\nconsole.log(baseState === nextState) // false\nconsole.log(nextState)\n/*\n[\n  { \n    title: "Learn TypeScript", \n    done: true,\n  },\n  { \n    title: "Learn TypeScript", \n    done: true,\n  },\n  { \n    title: "Tweet about It",\n  },\n]\n*/\n')),(0,a.kt)("admonition",{title:"Question",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Q2. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\ub294 \uc5b4\ub5bb\uac8c structural sharing\uc744 \uc0ac\uc6a9\ud558\ub294\uac78\uae4c?"),(0,a.kt)("p",{parentName:"admonition"},"*",(0,a.kt)("inlineCode",{parentName:"p"},"structural sharing"),": \uac1d\uccb4\ub97c copy\ud560 \ub54c \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc740 \uac1d\uccb4\ub294 reference\ub97c \ub3d9\uc77c\ud558\uac8c \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd.")),(0,a.kt)("p",null,"\uac1d\uccb4\ub97c immutable\ud558\uac8c \uc5c5\ub370\uc774\ud2b8 \ud55c\ub2e4\ub294 \uac83\uc740 \uae30\uc874 \uac1d\uccb4\ub97c \uc0c8\ub85c\uc6b4 \uac1d\uccb4\ub85c \ubcf5\uc0ac\ud55c\ub2e4\ub294 \uac83\uc774\ub2e4. \uc989, \ubcf5\uc0ac\uc5d0 \ube44\uc6a9\uc774 \ubc1c\uc0dd\ud55c\ub2e4.\nimmer\ub294 \uac1d\uccb4\ub97c \ubcf5\uc0ac\ud560 \ub54c, \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc740 reference\ub294 \uc7ac\uc0ac\uc6a9\ud558\ub294 structural sharing \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud574\uc11c \uac1d\uccb4\ub97c \ubcf5\uc0ac\ud55c\ub2e4.\nimmer\uc5d0\uc11c\ub294 \uc5b4\ub5a4\ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud574\uc11c structural sharing\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub294\uc9c0 \uc54c\uc544\ubcf8\ub2e4."),(0,a.kt)("admonition",{title:"Question",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Q3. immer\uc5d0\uc11c\ub294 produce\ud568\uc218 \ub0b4\uc5d0\uc11c draft\ub97c \uc9c1\uc811 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ubc29\uc2dd\uc774 \uc544\ub2c8\ub77c return\uc744 \ud1b5\ud574\uc11c \ub370\uc774\ud130\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\ub294\ub370, \uc774\ub7f0 \uacbd\uc6b0\uc5d0 \ub85c\uc9c1\uc774 \ub2e4\ub978\uc9c0?")),(0,a.kt)("p",null,"immer\ub97c \uc0ac\uc6a9\ud560 \ub54c, \uc704\uc5d0\uc11c \uc81c\uc2dc\ud55c mutable\ud55c \uac1d\uccb4 \ubcc0\uacbd \ubc29\uc2dd\uc774 \uc544\ub2cc, \uc0c8\ub85c\uc6b4 \uac1d\uccb4\ub97c \ub9ac\ud134\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\ub2e4.\n\uc774\ub294 immer\uc640\ub294 \ubb34\uad00\ud558\uac8c immutable\ud558\uac8c Javascript\uc5d0\uc11c \uac1d\uccb4\ub97c \ubc18\ud658\ud574\uc8fc\ub294 \ubc29\uc2dd\uacfc \ub3d9\uc77c\ud558\ub2e4.\nimmer\uc5d0\uc11c\ub294 \uc774\ub7ec\ud55c \ubc29\uc2dd\uc744 ",(0,a.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/return"},"\uacf5\uc2dd\uc801\uc73c\ub85c \ud5c8\uc6a9"),"\ud558\uace0 \uc788\uace0\n\ub450 \ubc29\uc2dd, mutable\ud558\uac8c \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uacfc immutable\ud558\uac8c \uac1d\uccb4\ub97c \ubcc0\uacbd\uc2dc\ud0a4\ub294 \ubc29\uc2dd \ubaa8\ub450 \ud63c\uc6a9\ud574\uc11c \uc4f0\ub294 \uac1c\ubc1c\uc790\ub3c4 \ub9ce\uc744 \uac83 \uc774\ub2e4.\n\uc774\ub7ec\ud55c \ubc29\uc2dd \ucc28\uc774\ub294 immer\uc5d0\uc11c \uc5b4\ub5a4 \ub85c\uc9c1\ucc28\uc774\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294\uc9c0 \uc54c\uc544\ubcf8\ub2e4. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'// mutable method\nconst nextState = produce(baseState, (draft) => {\n  draft.push({ title: "Tweet about It" });\n  draft[1].done = true;\n})\n\n// highlight-start\n// immutable method\nconst nextState = produce(baseState, (draft) => {\n  return {\n    ...baseState,\n    { ...baseState[1], done: true },\n    { title: "Tweet about It" },\n  }\n})\n// highlight-end\n')),(0,a.kt)("admonition",{title:"\uc0ac\uc804\uc9c0\uc2dd",type:"info"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"immer \ud639\uc740 redux-toolkit\uc744 \uc0ac\uc6a9\ud574 \ubcf8 \uacbd\ud5d8"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"},"Proxy"),"\uc5d0 \ub300\ud55c \uc774\ud574 (optional)"))),(0,a.kt)("h2",{id:"immer\ub294-\ubb34\uc5c7\uc774\uace0-\uc65c-\uc0ac\uc6a9\ud558\ub294\uac78\uae4c"},"Immer\ub294 \ubb34\uc5c7\uc774\uace0, \uc65c \uc0ac\uc6a9\ud558\ub294\uac78\uae4c?"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"immer\ub97c \uc65c \uc0ac\uc6a9\ud558\ub294\uc9c0 \uc798 \uc774\ud574\ud558\uace0 \uc788\ub2e4\uba74 \uc9c0\ub8e8\ud55c \uc774\uc57c\uae30\uac00 \ub420 \uc218 \uc788\ub2e4. \uc54c\uace0 \uc788\ub2e4\uba74 ",(0,a.kt)("a",{parentName:"em",href:"#%EC%82%AC%EC%9A%A9%EB%B2%95"},"\ub2e4\uc74c \ucc55\ud130\ub85c \ub118\uc5b4\uac00\uc790"),"."))),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/"},"immer"),"\ub780 \ubb34\uc5c7\uc778\uac00? immer \uacf5\uc2dd \ubb38\uc11c\uc5d0\uc11c\uc758 \uc18c\uac1c \ubb38\uad6c\ub97c \uac00\uc838\uc640\ubcf4\uc790."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"Immer")," (German for: always) is a tiny package that allows you to work with immutable state in a more convenient way.")),(0,a.kt)("p",null,"immer\ub294 javascript\uc5d0\uc11c data\uac00 immutable\ud558\uac8c \uc5c5\ub370\uc774\ud2b8 \ub418\ub294 \uac83\uc744 \ubcf4\uc7a5\ud574\uc8fc\ub294 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc774\ub2e4."),(0,a.kt)("p",null,"\uadf8\ub807\ub2e4\uba74 immer\ub294 \uc5b4\ub514\uc11c \uc4f0\uc774\uace0 \uc788\uc744\uae4c? ",(0,a.kt)("br",null),"\nredux\uc758 style guide\uc5d0\uc11c\ub294 ",(0,a.kt)("a",{parentName:"p",href:"https://ko.redux.js.org/style-guide/style-guide#use-redux-toolkit-for-writing-redux-logic"},"redux-toolkit\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5"),"\ud558\uace0 \uc788\uace0 immutable data \uad00\ub9ac\ub97c \uc704\ud574\uc11c\ub294\n",(0,a.kt)("a",{parentName:"p",href:"https://ko.redux.js.org/style-guide/style-guide#use-immer-for-writing-immutable-updates"},"immer\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\ub2e4\uace0 \uad8c\uc7a5"),"\ud558\uace0 \uc788\ub2e4.\n\ubb3c\ub860 ",(0,a.kt)("a",{parentName:"p",href:"https://redux-toolkit.js.org/"},"redux-toolkit"),"\uc5d0\ub294 immer\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uc73c\ubbc0\ub85c redux-toolkit\uc744\n\uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4\uba74 \uc774\ubbf8 redux\uc5d0 immer\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("p",null,"\uc65c immutable data\ub97c \uc0ac\uc6a9\ud574\uc57c\ud558\ub294\uac00\ub294 ",(0,a.kt)("a",{parentName:"p",href:"https://ko.redux.js.org/style-guide/style-guide#use-immer-for-writing-immutable-updates"},"redux\uc758 FAQ\ud56d\ubaa9"),"\uc744 \ucc38\uace0\ud558\ub294 \uac83\uc774 \uc88b\ub2e4. ",(0,a.kt)("br",null),"\n\ub0b4\uc6a9\uc744 \uac04\ub7b5\ud558\uac8c \uc124\uba85\ud558\uc790\uba74, \ub2e4\uc74c\uacfc \uac19\ub2e4. ",(0,a.kt)("br",null),"\njavascript\uc5d0\uc11c\ub294 primitive\ud55c \ud0c0\uc785\uc758 \ubcc0\uc218(number, string, etc)\ub97c \uc81c\uc678\ud558\uba74 \ubaa8\ub450 mutable\ud55c \uc18d\uc131\uc744 \uac00\uc9c4\ub2e4.\nnon-primitive\ud55c \ud0c0\uc785\uc740 object, array\uc640 \uac19\uc740 \uac83\ub4e4\uc774 \uc788\ub2e4.\nnon-primitive\ud55c \ud0c0\uc785\uc758 \ubcc0\uc218\ub294 \ubcc0\uacbd\ub418\uc5b4\ub3c4 \ubcc0\uc218\uc758 reference\uac00 \ubc14\ub00c\uc9c0 \uc54a\ub294\ub2e4. \ub530\ub77c\uc11c object \ub0b4\ubd80\uac00 \ubcc0\uacbd\ub418\ub354\ub77c\ub3c4 reference\uac00 \ubcc0\uacbd\ub418\uc9c0 \uc54a\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"let primitive = 5;\nlet primitive2 = primitive;\n\nconsole.log(primitive === primitive2) // true\nprimitive2 = 10;\n\nconsole.log(primitive === primitive2) // false\n\n\nlet nonPrimitive = { a: 5 };\nlet nonPrimitive2 = nonPrimitive;\n\nconsole.log(nonPrimitive === nonPrimitive2) // true\n\nnonPrimitive2.b = 10;\n\nconsole.log(nonPrimitive === nonPrimitive2) // true\nconsole.log(nonPrimitive) \n// { a: 5, b: 10 }  \n")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://redux-saga.js.org/"},"redux"),"\uc5d0\uc11c\ub294 shallow equality checking\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4. shallow equality checking\uc740 \ub370\uc774\ud130\uac00 \ub3d9\uc77c\ud55c\uc9c0 \ube44\uad50\ud560 \ub54c,\n\ub370\uc774\ud130 \ub0b4\ubd80\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c \ud655\uc778\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c \ub370\uc774\ud130\uc758 reference\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub9cc \uccb4\ud06c\ub97c \ud558\uace0 \ub3d9\uc77c\ud558\uba74 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc558\ub2e4\uace0 \ud310\ub2e8\ud558\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("p",null,"\ub9cc\uc57d deep equality checking\uc744 \uc0ac\uc6a9\ud558\uba74 \ubaa8\ub4e0 \uac1d\uccb4\ub97c \ud558\ub098\uc529 \ube44\uad50\ud574\uc57c\ud558\uae30 \ub54c\ubb38\uc5d0 \uc131\ub2a5\uc0c1 \uc190\ud574\ub97c \ubcf4\uac8c\ub41c\ub2e4.\n\uadf8\ub798\uc11c object\uac12\uc744 \ubcc0\uacbd\ud560 \ub54c reference\ub3c4 \ubcc0\uacbd\ub418\ub294 \uac83\uc744 \ubcf4\uc7a5\ud558\ub294 immutable data\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uc5c8\uace0 \uc5b4\ub5a4 \ubcc0\uacbd\uc774\ub354\ub77c\ub3c4 \uac1d\uccb4\uac00 immutable\ud568\uc744 \ubcf4\uc7a5\ud574\uc8fc\ub294 immer\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("p",null,"\ub9cc\uc57d \ub530\ub85c immer\ub97c \uc758\uc2dd\uc801\uc73c\ub85c \uc0ac\uc6a9\ud55c \uc801\uc774 \uc5c6\ub354\ub77c\ub3c4, redux\ub97c \uc0ac\uc6a9\ud558\ub294\ub370 redux-toolkit\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4\uba74\n\uc774\ubbf8 immer\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("h2",{id:"\uc0ac\uc6a9\ubc95"},"\uc0ac\uc6a9\ubc95"),(0,a.kt)("p",null,"immer\uc758 \ub0b4\ubd80\ub97c \ud655\uc778\ud558\uae30 \uc804\uc5d0 immer\ub97c \uc5b4\ub5bb\uac8c \uc0ac\uc6a9\ud558\ub294\uc9c0 \ud55c\ubc88 \ud655\uc778\ud574\ubcf4\uc790.\n\ub2e4\uc74c\uc740 ",(0,a.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/#a-quick-example-for-comparison"},"immer docs"),"\uc5d0 \ub098\uc640 \uc788\ub294 \uc608\uc81c\uc774\ub2e4."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"baseState\ub97c immutable\ud558\uac8c \ubcc0\uacbd\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \ube44\uad50.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'const baseState = [\n  {\n    title: "Learn TypeScript",\n    done: true\n  },\n  {\n    title: "Try Immer",\n    done: false\n  }\n]\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// without immer\nconst nextState = baseState.slice()\n\nnextState[1] = { \n  ...nextState[1], \n  done: true, \n}\nnextState.push({ title: 'Tweet about it' })\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'// with immer\nimport produce from "immer"\n\nconst nextState = produce(baseState, draft => {\n    draft[1].done = true\n    draft.push({ title: "Tweet about it" })\n})\n')),(0,a.kt)("p",null,"immer\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc73c\uba74 \ubcf5\uc0ac \u2192 \uc5c5\ub370\uc774\ud2b8 \uacfc\uc815\uc744 \uc9c4\ud589\ud558\uace0, \uc774 \uacfc\uc815\uc5d0\uc11c mutable\ud558\uac8c \ubcc0\uacbd\ub418\uc9c4 \uc54a\ub294\uc9c0 \ud655\uc778\ud574\uc57c\ud558\ub294 \ubc18\uba74,\nimmer\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"produce")," \ub97c \uc0ac\uc6a9\ud558\uba74 \uc5b4\ub5a4 \ubc29\uc2dd\uc73c\ub85c \uc0ac\uc6a9\ud558\ub354\ub77c\ub3c4 data\uac00 immutable\ud558\ub2e4\ub294 \uac83\uc744 \ubcf4\uc7a5 \ud560 \uc218 \uc788\ub2e4."),(0,a.kt)("p",null,"\ub9cc\uc57d immer\ub97c \uc9c1\uc811 \uc0ac\uc6a9\ud574 \ubcf8 \uc801 \uc5c6\uace0, ",(0,a.kt)("a",{parentName:"p",href:"https://redux-toolkit.js.org/"},"redux-toolkit"),"\uc744 \uc0ac\uc6a9\ud574\uc11c redux\ub97c \uc0ac\uc6a9\ud558\uc600\ub2e4\uba74 immer\ub97c \uc774\ubbf8 \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \uac83\uc774\ub2e4.\n\uc798 \ubaa8\ub974\uaca0\ub2e4\uba74 redux-toolkit\uc5d0\uc11c state\ub97c mutation\ud558\ub294 ",(0,a.kt)("a",{parentName:"p",href:"https://redux-toolkit.js.org/api/createReducer#direct-state-mutation"},"\ubc29\ubc95\uc5d0 \ub300\ud55c \ubb38\uc11c"),"\ub97c \uc77d\uc5b4\ubcf4\uc790."),(0,a.kt)("h2",{id:"deep-dive-\uc804-immer\uc5d0-\ub300\ud574\uc11c"},"deep-dive \uc804 immer\uc5d0 \ub300\ud574\uc11c"),(0,a.kt)("p",null,"\uba3c\uc800 immer\uc758 \uc6d0\ub9ac\ub97c \uc774\uc57c\uae30 \ud574\ubcfc \uc608\uc815\uc774\ub2e4.\n\uc5ec\uae30\uc11c \uc124\uba85\ud558\ub294 \ub0b4\uc6a9\uc740 ",(0,a.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/#how-immer-works"},"immer\uc758 \ubb38\uc11c"),"\uc640 \ubb38\uc11c\uc758 FAQ\uc5d0 \ub9c1\ud06c\ub418\uc5b4 \uc788\ub294\n",(0,a.kt)("a",{parentName:"p",href:"https://medium.com/hackernoon/introducing-immer-immutability-the-easy-way-9d73d8f71cb3#3bff"},"blog \uae00")," \uc744 \ucc38\uace0\ud558\uba74 \ub354 \uc27d\uac8c \uc774\ud574\ud560 \uc218 \uc788\uc744 \uac83\uc774\ub2e4."),(0,a.kt)("h3",{id:"immer\ub294-\uc6d0\ub798-\uac1d\uccb4\ub97c-\ubcc0\uacbd\uc2dc\ud0a4\uc9c0-\uc54a\ub294\ub2e4"},"immer\ub294 \uc6d0\ub798 \uac1d\uccb4\ub97c \ubcc0\uacbd\uc2dc\ud0a4\uc9c0 \uc54a\ub294\ub2e4."),(0,a.kt)("p",null,"immer\ub294 \uac1d\uccb4\ub97c \uc9c1\uc811 \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 original data(",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),")\ub97c \uadf8\ub300\ub85c \ub450\uace0, copy data(",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),")\ub97c \uc0dd\uc131\ud558\uace0 \ubcc0\uacbd\ud558\ub294 \ub3d9\uc791\uc744 \uc9c4\ud589\ud55c\ub2e4.\n\uc774\ub7f0 \uc6d0\ub9ac\ub97c \uc774\uc6a9\ud574\uc11c \uae30\uc874 \ub370\uc774\ud130\ub97c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uc740 \ucc44 \ubcc0\uacbd\ub41c \ub370\uc774\ud130\ub97c \ub9ac\ud134\ud55c\ub2e4."),(0,a.kt)("h3",{id:"immer\ub294-\uac1d\uccb4\uac00-\ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c-\uae30\ub85d\ud55c\ub2e4"},"immer\ub294 \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c \uae30\ub85d\ud55c\ub2e4."),(0,a.kt)("p",null,"immer\ub294 \uac1d\uccb4\ub97c \ubcc0\uacbd\ud560 \ub54c modified flag\ub97c ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"\ub85c \uc124\uc815\ud55c\ub2e4.\n\ub9cc\uc57d \uac1d\uccb4 \ud2b8\ub9ac\uc758 \uae4a\uc219\ud55c \uacf3\uc774 \ubcc0\uacbd\ub418\uc5c8\ub2e4\uba74 \ubcc0\uacbd\ub41c \uc790\uc2e0\uc744 \ud3ec\ud568\ud558\uc5ec root \ud2b8\ub9ac\uae4c\uc9c0 modified flag\ub97c \ubcc0\uacbd\ud558\uc5ec root\uc5d0\uc11c\ub3c4 \uac1d\uccb4 \ud2b8\ub9ac\uc758 \ub05d\uae4c\uc9c0 \uc21c\ud68c\ud560 \uc218 \uc788\ub3c4\ub85d \uc870\uc815\ud55c\ub2e4."),(0,a.kt)("p",null,"\uac1d\uccb4 \ubcc0\uacbd\uacfc\uc815\uc744 \ub9c8\uce5c \ub4a4\uc5d0\ub294 modified flag\ub97c \ud655\uc778\ud558\uc5ec \ubcc0\uacbd\ub41c \uac1d\uccb4\ub4e4\ub9cc copy data(",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),")\ub97c \uc0ac\uc6a9\ud558\uace0\nmodified \ub418\uc9c0 \uc54a\uc558\ub2e4\uba74 original data(",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),")\ub97c \uc0ac\uc6a9\ud574\uc11c \uae30\uc874 reference\ub97c \uc7ac\uc0ac\uc6a9\ud568\uc73c\ub85c\uc368 structural share\ub97c \uc0ac\uc6a9\ud55c\ub2e4."),(0,a.kt)("h3",{id:"recap"},"Recap"),(0,a.kt)("p",null,"\uc989, \uc815\ub9ac\ud558\uc790\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 3\uc904\ub85c \uc815\ub9ac\ub41c\ub2e4."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"original data\uc640 copy data 2\uac00\uc9c0 \uac1d\uccb4\ub97c \uad00\ub9ac\ud558\uc5ec \uc6d0\ubcf8\uc744 \ubcf4\uc874\ud558\uace0 copy data\ub9cc \ubcc0\uacbd\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"\ubcc0\uacbd\ud55c \uac1d\uccb4\ub294 modified flag\ub97c \ucf1c\uc11c root tree\uc5d0\uc11c leaf tree\uae4c\uc9c0 \uc21c\ud68c\ud560 \uc218 \uc788\ub3c4\ub85d \ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"\ubcc0\uacbd\uc774 \uc644\ub8cc\ub41c \ub4a4 modifed flag\ub97c \uc774\uc6a9\ud574\uc11c \uc0c8 \uac1d\uccb4\uc640 \uae30\uc874 \uac1d\uccb4\ub97c \ud569\uc131\ud558\ub294 \uacfc\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4.")),(0,a.kt)("h2",{id:"deep-dive-to-immer"},"Deep dive to immer"),(0,a.kt)("p",null,"\uc790, immer\ub85c deep dive \ud574\ubcf4\uc790. ",(0,a.kt)("br",null),"\nimmer \ub85c\uc9c1\uc744 \ud655\uc778\ud574\ubcf4\ub824\uba74 usage\uc5d0\uc11c \uc0ac\uc6a9\ud588\ub358 ",(0,a.kt)("inlineCode",{parentName:"p"},"produce")," \ud568\uc218\ub97c \uba3c\uc800 \uc0b4\ud3b4\ubd10\uc57c\ud55c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/immer.ts#L23-L45\nconst immer = new Immer();\nexport const produce = immer.produce;\nexport default produce;\n")),(0,a.kt)("p",null,"produce\ud568\uc218\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"Immer")," \ud074\ub798\uc2a4\uc758 \uba54\uc18c\ub4dc \ud568\uc218\uc774\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"Immer")," class \uc548\uc744 \uc0b4\ud3b4\ubcf4\uc790."),(0,a.kt)("p",null,"produce\ud568\uc218\uc5d0\uc11c curring \ud568\uc218 \ub300\uc751\uacfc \uc5ec\ub7ec \uc608\uc678 \ucf00\uc774\uc2a4\ub97c \uc81c\uc678\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \ucd95\uc18c\ub41c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/immerClass.ts#L66-L122\nexport class Immer {\n  produce: (base, recipe) => { \n    let result;\n\n    const scope = enterScope(this);\n    const proxy = createProxy(this, base, undefined);\n    \n    result = recipe(proxy);\n\n    return processResult(result, scope);     \n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"produce")," \ud568\uc218\uac00 \uc0dd\uac01\ubcf4\ub2e4 \uac04\ub2e8\ud558\ub2c8, \uc5ec\uae30\uc11c produce \ud568\uc218 \ub85c\uc9c1\uc758 \uc21c\uc11c\ub97c \uc9da\uace0 \ub118\uc5b4\uac00\uc790."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"produce")," \ud568\uc218\ub294 \uae30\uc874 \uac1d\uccb4(",(0,a.kt)("inlineCode",{parentName:"li"},"base"),")\uc640 \uac1d\uccb4\ub97c \uc5b4\ub5bb\uac8c \ubcc0\uacbd\uc2dc\ud0ac\uc9c0 \uacb0\uc815\ud558\ub294 \ud568\uc218(",(0,a.kt)("inlineCode",{parentName:"li"},"recipe"),")\ub97c \uc778\uc790\ub85c \ubc1b\ub294\ub2e4."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"scope"),"\ub97c \uc0dd\uc131\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"proxy"),"\ub97c \uc0dd\uc131\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"proxy"),"\ub97c \uc774\uc6a9\ud574\uc11c ",(0,a.kt)("inlineCode",{parentName:"li"},"recipe"),"\ub97c \uc2e4\ud589\uc2dc\ud0a8\ub2e4."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"processResult"),"\ub97c \uc774\uc6a9\ud574\uc11c \uc5c5\ub370\uc774\ud2b8 \ub41c \ucd5c\uc885 \uac1d\uccb4\ub97c \ub9ac\ud134\ud55c\ub2e4.")),(0,a.kt)("p",null,"\uc5ec\uae30\uc11c \uc758\ubb38\uc744 \uac00\uc838\uc57c\ud558\ub294 \uc810\uc740 mutable\ud558\uac8c \ubcc0\uacbd\uc2dc\ud0a4\ub294 \ub85c\uc9c1\uc774 ",(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\uc5d0 \ud3ec\ud568\ub418\uc5b4 \uc788\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\ub294 \ub2e8\uc21c\ud788 \ud638\ucd9c\ub420 \ubfd0\uc774\ub77c\ub294 \uac83\uc774\ub2e4.\n\ud558\uc9c0\ub9cc ",(0,a.kt)("inlineCode",{parentName:"p"},"recipe")," \ub0b4\ubd80\uc758 mutable\ud55c \ubcc0\uacbd\ub85c\uc9c1\uc740 \ub300\uc0c1 \uac1d\uccb4\ub97c \uc9c1\uc811 \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 immutable\uc744 \ubcf4\uc7a5\uc2dc\ucf1c\uc900\ub2e4."),(0,a.kt)("p",null,"\ube44\ubc00\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy"),"\uc5d0 \uc788\uc744 \uac83 \uac19\ub2e4. \uc2e4\uc81c\ub85c ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy"),"\ub97c \ub9cc\ub4e4 \ub54c ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"},"new Proxy"),"\ub97c\n\uc0ac\uc6a9\ud558\uace0 \uc788\uace0, \uc774 ",(0,a.kt)("inlineCode",{parentName:"p"},"new Proxy"),"\uac00 immer\uc758 \uc8fc\uc694 \ub85c\uc9c1\uc5d0 key point\ub85c \uc791\uc6a9\ud55c\ub2e4."),(0,a.kt)("p",null,"\ucc28\uadfc\ucc28\uadfc \ud558\ub098\uc529 \uc0b4\ud3b4\ubcf4\uc790."),(0,a.kt)("h3",{id:"scope"},"scope"),(0,a.kt)("p",null,"scope\ub294 immer \uc804\uc5ed\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc815\ubcf4\ub4e4\uc744 \uc800\uc7a5\ud558\ub294 \uac1d\uccb4\uc774\ub2e4. immer\uc758 \uae30\ubcf8\ub3d9\uc791\uc5d0\ub294 \ud06c\uac8c \uc4f0\uc774\uc9c0 \uc54a\uc73c\ubbc0\ub85c \uc5b4\ub5a4 \ub370\uc774\ud130\ub97c \uc800\uc7a5\ud558\uace0 \uc788\ub294\uc9c0\ub9cc \ud6d1\uace0 \ub118\uc5b4\uac00\uc790."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/scope.ts#L33-L46\nfunction createScope(\n  parent_: ImmerScope | undefined,\n  immer_: Immer\n): ImmerScope {\n  return {\n    drafts_: [],\n    parent_,\n    immer_,\n    canAutoFreeze_: true,\n    unfinalizedDrafts_: 0\n  }\n}   \n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"drafts_"),"\ub294 \ub098\uc911\uc5d0 \ub9cc\ub4dc\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy")," \ub97c \uc0dd\uc131\ud560 \ub54c \ud558\ub098\uc529 \ub2f4\uae30\ub294 \ubc30\uc5f4\uc774\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"immer_"),"\ub294 immer \ud074\ub798\uc2a4\ub97c \ub2f4\ub294 \uacf5\uac04\uc774\ub2e4."),(0,a.kt)("h3",{id:"proxy"},"proxy"),(0,a.kt)("p",null,"immer\uc758 \ud575\uc2ec\uc774 \ub418\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy"),"\uc5d0 \ub300\ud574\uc11c \ud655\uc778\ud574\ubcf4\uc790."),(0,a.kt)("p",null,"immer\uc5d0\uc11c\ub294 Object \ubfd0 \uc544\ub2c8\ub77c Array, Map, Set \uadf8\ub9ac\uace0 Proxy\ub97c \uc4f0\uc9c0 \ubabb\ud558\ub294 \uacbd\uc6b0(ES5)\uae4c\uc9c0 \ub300\uc751\ud558\ubbc0\ub85c \ucf54\ub4dc\uac00 \ubcf5\uc7a1\ud574\ubcf4\uc774\ub294\ub370,\nObject\ub9cc\uc73c\ub85c \ud55c\uc815\ud574\uc11c \ubcf8\ub2e4\uba74 \ub85c\uc9c1\uc774 \uc870\uae08 \uac04\ub2e8\ud574\uc9c4\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/immerClass.ts#L212-L229\nexport function createProxy(immer, value, parent) {\n  const draft = createProxyProxy(value, parent);\n  const scope = getCurrentScope();\n  \n  scope.drafts_.push(draft);\n  return draft;\n}\n")),(0,a.kt)("p",null,"proxy\ub97c \uc5b4\ub5bb\uac8c \ub9cc\ub4dc\ub294\uc9c0\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"createProxyProxy")," \ud568\uc218\ub97c \ud55c\ubc88 \ub354 \ub4e4\uc5b4\uac00\uc57c \ud655\uc778\ud560 \uc218 \uc788\uaca0\uc9c0\ub9cc,\n\uc5ec\uae30\uc11c \uc8fc\ubaa9\ud560 \uc810\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"scope.drafts_")," \uc5d0 \uc0dd\uc131\ud55c proxy\ub97c \ub123\uc5b4\ub454\ub2e4\ub294 \uac83\uc774\ub2e4. \ub9e8 \ucc98\uc74c \ub9cc\ub4e0 proxy\uac00 root proxy\uc774\uae30 \ub54c\ubb38\uc5d0\n\ub098\uc911\uc5d0 rootProxy\ub97c \ud68d\ub4dd\ud560 \ub54c ",(0,a.kt)("inlineCode",{parentName:"p"},"scope.drafts_[0]"),"\ub97c \ucc38\uc870\ud560 \uc608\uc815\uc774\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/proxy.ts#L50-L95\nexport function createProxyProxy(base, parent) {\n  const state = {\n    ...\n    scope_: getCurrentScope(),\n    modified_: false,\n    finalized_: false,\n    parent_: parent,\n    base_: base,\n    draft_: null,\n    copy_: null,\n    ...\n  }\n\n  const target = state;\n  const traps = objectTraps\n  const { revoke, proxy } = Proxy.revocable(target, traps);\n  state.draft_ = proxy;\n  state.revoke_ = revoke\n  \n  return proxy;\n} \n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"createProxyProxy"),"\uc5d0\uc11c\ub294 immer \ub3d9\uc791\uc5d0 \uc0ac\uc6a9\ud560 \uc5ec\ub7ec \uba54\ud0c0 \ub370\uc774\ud130\ub4e4\uacfc \uc0c8 ",(0,a.kt)("inlineCode",{parentName:"p"},"Proxy"),"\uac1d\uccb4\ub97c \uc0dd\uc131\ud55c\ub2e4.\nimmer\uc5d0\uc11c \uc4f0\uc774\ub294 \uba54\ud0c0\ub370\uc774\ud130\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \uc815\ub9ac\ub41c\ub2e4."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"base_"),": \uae30\uc874 data. produce\uc5d0\uc11c \uccab\ubc88\uc9f8 \uc778\uc790\ub85c \ub4e4\uc5b4\uc654\uc73c\uba70 \ubcc0\uacbd\ub418\uae30 \uc774\uc804 \uc6d0\ubcf8 \ub370\uc774\ud130\ub97c \uc5ec\uae30\uc5d0 \uc800\uc7a5\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),": \uc5c5\ub370\uc774\ud2b8 \ub41c data. \uc6d0\ubcf8 \ub370\uc774\ud130\uc640 ",(0,a.kt)("inlineCode",{parentName:"li"},"recipe"),"\ub97c \uc774\uc6a9\ud574\uc11c \uc5c5\ub370\uc774\ud2b8 \ub41c \ub370\uc774\ud130\ub97c \uc5ec\uae30\uc5d0 \uc800\uc7a5\ud55c\ub2e4. \uc544\uc9c1\uc740 \uc544\ubb34 \ub370\uc774\ud130\ub3c4 \uc800\uc7a5\ub418\uc5b4 \uc788\uc9c0 \uc54a\ub2e4."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"draft_"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"draft_")," \ub294 \uc5ec\uae30\uc11c \uc0dd\uc131\ub418\ub294 ",(0,a.kt)("inlineCode",{parentName:"li"},"Proxy")," \uac1d\uccb4\ub97c \uc800\uc7a5\ud55c\ub2e4. \uc55e\uc73c\ub85c\uc758 \ub85c\uc9c1\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"li"},"draft_.base_"),"\ub098 ",(0,a.kt)("inlineCode",{parentName:"li"},"draft_.copy_"),"\uc640 \uac19\uc740 \ubc29\ubc95\uc73c\ub85c \ub370\uc774\ud130\ub97c \ucc38\uc870\ud558\uac8c \ub41c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"modified_"),": \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0 \uc5ec\ubd80\ub97c \uc800\uc7a5\ud55c\ub2e4. \uae30\ubcf8 \uac12\uc740 \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc558\uc73c\ubbc0\ub85c ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," \uc774\ub2e4."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"finalized_"),": proxy\uac00 \uc5c5\ub370\uc774\ud2b8\uac00 \uc644\ub8cc\ub418\uc5b4 return \ub420 \uc900\ube44\uac00 \ub418\uc5c8\ub294\uc9c0\ub97c \uc800\uc7a5\ud55c\ub2e4. \uae30\ubcf8 \uac12\uc740 \uac1d\uccb4\uac00 \uc900\ube44 \uc911\uc774\ubbc0\ub85c ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," \uc774\ub2e4. "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"parent_"),": \uac1d\uccb4\ub294 multi depth\ub85c \uad6c\uc131\ub420 \uc218 \uc788\ub2e4. \ub9cc\uc57d \uac1d\uccb4\uac00 \ud2b8\ub9ac \ud615\ud0dc\ub85c \uad6c\uc131\ub41c\ub2e4\uba74 \ubd80\ubaa8 \uac1d\uccb4\ub97c \uc774 \uacf3\uc5d0 \uc800\uc7a5\ud558\uac8c \ub41c\ub2e4. root proxy\uc5d0\uc11c\ub294 \ubd80\ubaa8\uac00 \uc5c6\ub2e4.")),(0,a.kt)("p",null,"\uc8fc\uc694 \uba54\ud0c0\ub370\uc774\ud130\ub4e4\uc740 \uc704\uc5d0\uc11c \uc815\ub9ac\ud55c \uc815\ub3c4\uc774\ub2e4. \uba54\ud0c0 \ub370\uc774\ud130\uc758 \uae30\ubcf8 \uac12\uc744 \uc124\uc815\ud558\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"Proxy.revocable"),"\uacfc ",(0,a.kt)("inlineCode",{parentName:"p"},"traps"),"\ub97c \uc774\uc6a9\ud574\uc11c Proxy \uac1d\uccb4\ub97c \uc0dd\uc131\ud55c\ub2e4. Proxy\uc5d0 \ub300\ud574\uc11c\ub294 \ub2e4\uc74c \ucc55\ud130\uc5d0\uc11c \uc54c\uc544\ubcf4\uc790."),(0,a.kt)("admonition",{title:"\uc6a9\uc5b4 \uc815\ub9ac",type:"info"},(0,a.kt)("h3",{parentName:"admonition",id:"proxy-proxy"},"proxy? Proxy?"),(0,a.kt)("p",{parentName:"admonition"},"\uc55e\uc73c\ub85c immer\uc5d0\uc11c meta \ub370\uc774\ud130\ub97c \ud3ec\ud568\ud574\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"new Proxy")," \uac1d\uccb4\ub97c \ud3ec\ud568\ud558\ub294 \ubcc0\uc218 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy"),"\ub97c \uc5b8\uae09\ud558\uae30\ub3c4 \ud558\uace0,\n\uc6a9\uc5b4 \uadf8\ub300\ub85c Javascript\uc5d0\uc11c object\uc5d0 \ub300\ud55c \uc5ec\ub7ec \uae30\ubcf8 \ub3d9\uc791\uc744 \uc81c\uc5b4\ud558\uae30 \uc704\ud55c \uac1d\uccb4 ",(0,a.kt)("inlineCode",{parentName:"p"},"Proxy"),'\ub97c \uc5b8\uae09\ud558\uae30\ub3c4 \ud560 \uc608\uc815\uc774\ub2e4.\n\uacf5\uad50\ub86d\uac8c\ub3c4 \ub450 \uc6a9\uc5b4\uac00 "\ud504\ub85d\uc2dc" \ub85c \ub3d9\uc77c\ud55c \uc6a9\uc5b4\uc774\uae30 \ub54c\ubb38\uc5d0 \uc774 \uae00\uc5d0\uc11c\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 ',(0,a.kt)("inlineCode",{parentName:"p"},"p")," \ub300, \uc18c\ubb38\uc790 \uc720\ubb34\ub85c \uad6c\ubd84\ud574\uc11c \uc0ac\uc6a9\ud560 \uc608\uc815\uc774\ub2e4."),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"proxy"),": immer\uc5d0\uc11c \uc0dd\uc131\ud55c \uba54\ud0c0 \ub370\uc774\ud130\uc640 ",(0,a.kt)("inlineCode",{parentName:"li"},"new Proxy"),"\ub85c \uc0dd\uc131\ud55c draft\ub97c \ud3ec\ud568\ud558\uace0 \uc788\ub294 \uac1d\uccb4."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Proxy"),": javascript\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 built-in \uac1d\uccb4. Object\uc758 \uc5ec\ub7ec \uae30\ubcf8 \ub3d9\uc791\uc744 \uc81c\uc5b4\ud558\uae30 \uc704\ud55c \uac1d\uccb4\ub85c \uc4f0\uc778\ub2e4."))),(0,a.kt)("h3",{id:"new-proxy"},"new Proxy"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"\uc774\ubc88 \ucc55\ud130\uc5d0\uc11c\ub294 ",(0,a.kt)("a",{parentName:"em",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"},"new Proxy"),"\uac00\n\uc5b4\ub5a4 \uac83\uc778\uc9c0 \uc54c\uc544\ubcf4\ub294 \uc2dc\uac04\uc744 \uac00\uc9c8 \uac83\uc774\ub2e4. Proxy\uc5d0 \ub300\ud574 \uc775\uc219\ud558\ub2e4\uba74 ",(0,a.kt)("a",{parentName:"em",href:"#traps-of-immer"},"\ub2e4\uc74c \ucc55\ud130\ub85c \ub118\uc5b4\uac00\ub3c4 \ubb34\uad00\ud558\ub2e4"),"."))),(0,a.kt)("p",null,"\uc6b0\ub9ac\ub294 \uc774\uc804 \ucc55\ud130\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"Proxy.revocable")," \uc744 \uc774\uc6a9\ud574\uc11c Proxy \uac1d\uccb4\ub97c \ub9cc\ub4e4\uc5c8\ub2e4."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"},"MDN \ubb38\uc11c"),"\uc5d0\uc11c Proxy\uc5d0 \ub300\ud574 \uc815\uc758\ud55c \ub0b4\uc6a9\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The Proxy object enables you to create a proxy for another object, which can intercept and redefine fundamental operations for that object.")),(0,a.kt)("p",null,"Proxy \uac1d\uccb4\ub294 object\uc758 \uae30\ub2a5, set\uacfc get\uacfc \uac19\uc740 \uae30\ub2a5\ub4e4\uc744 intercept\ud558\uac70\ub098 redefine\uc744 \ud558\ub294 \uc0c8\ub85c\uc6b4 \uac1d\uccb4\ub97c \uc0dd\uc131\ud55c\ub2e4.\nimmer\uc5d0\uc11c\ub294 \uc6d0\ubcf8 \uac1d\uccb4\ub85c Proxy \uac1d\uccb4\ub97c \ub9cc\ub4e4\uc5b4 \uc6d0\ubcf8 \uac1d\uccb4\ub97c get, set\ud560 \ub54c \uc9c1\uc811\uc801\uc73c\ub85c \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c \ub2e4\ub978 \ubc29\uc2dd\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ub97c \ud558\uac8c\ub054 \ub85c\uc9c1\uc744\nintercept\ud558\ub294\ub370 Proxy\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4."),(0,a.kt)("p",null,"\uc608\ub97c\ub4e4\uc5b4\uc11c Object\uac00 \uc788\uace0 set\uc744 \ud560\ub54c \uc124\uc815\ud55c \uac12\uc744 2\ubc30\ub85c \ub9cc\ub4e4\uace0 \uc2f6\ub2e4\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \uc0ac\uc6a9\ud558\uba74 \ub41c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const origin = {};\nconst handler = {\n  set: function(target, prop, value) {\n    if (typeof value === 'number') {\n      target[prop] = value * 2;\n    } else {\n      Reflect.set(...arguments);\n    }\n  }\n}\n\nconst proxy = new Proxy(origin, handler);\n\nproxy.a = 10;\nproxy.b = {};\n\nconsole.log(proxy.a); // 20\nconsole.log(proxy.b); // {}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"proxy.a"),"\uc5d0 \ud560\ub2f9\ud560 \ub54c \uc77c\ubc18 \uac1d\uccb4\uc758 set\uc744 \uc0ac\uc6a9\ud558\ub294\uac8c \uc544\ub2c8\ub77c ",(0,a.kt)("inlineCode",{parentName:"p"},"Proxy")," \uac1d\uccb4\ub97c \ub9cc\ub4e4\ub54c \ub4f1\ub85d\ud588\ub358 ",(0,a.kt)("inlineCode",{parentName:"p"},"handler.set"),"\uc758 \ub85c\uc9c1\uc744 \ub530\ub974\uac8c \ub41c\ub2e4.\nset\ud558\ub294 value\uac00 10\uc774\uae30 \ub54c\ubb38\uc5d0 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.a")," \uc5d0\ub294 10\uc774 \uc544\ub2cc 20\uc774 \uc800\uc7a5\ub41c\ub2e4. value\uac00 number\uac00 \uc544\ub2d0\ub54c\uc758 \ub3d9\uc791\uc5d0\uc11c \uc4f0\uc774\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"Reflect")," \ub294 \uae30\uc874 \ub85c\uc9c1\uc744 \ub530\ub974\uac8c \ud560 \ub54c \uc0ac\uc6a9\ud55c\ub2e4."),(0,a.kt)("p",null,"\uc790, \ub9cc\uc57d\uc5d0 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.b")," \uac1d\uccb4\uc5d0 \ucd94\uac00\ub85c \uac12\uc744 \ud560\ub2f9\ud558\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c? ",(0,a.kt)("inlineCode",{parentName:"p"},"handler.set"),"\uc774 \uc0ac\uc6a9\ub418\uc5b4 40\uc774 \ud560\ub2f9\ub420\uae4c? \uc544\ub2c8\uba74 \uadf8\ub300\ub85c 20\uc774 \ud560\ub2f9\ub420\uae4c?"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"proxy.b.c = 20\n\nconsole.log(proxy.b.c) // 20? 40?\n")),(0,a.kt)("p",null,"\uc815\ub2f5\uc740 20\uc774\ub2e4. \uadf8 \uc774\uc720\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy"),"\ub294 Proxy \uac1d\uccb4\uc774\uc9c0\ub9cc, ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.b"),"\ub294 Proxy \uac1d\uccb4\uac00 \uc544\ub2c8\ub77c \uc77c\ubc18 \uac1d\uccb4\uc774\uae30 \ub54c\ubb38\uc774\ub2e4.\n\ub530\ub77c\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"handler.set"),"\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 \uc77c\ubc18 \uac1d\uccb4\uc758 set\uc744 \uc0ac\uc6a9\ud558\uc5ec \uadf8\ub300\ub85c 20\uc744 \ud560\ub2f9\ud558\uace0 \uc788\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("p",null,"\uc774\ub7ec\ud55c \ub3d9\uc791\uc740 immer\uc5d0\uc11c critical\ud558\uac8c \uc791\uc6a9\ub41c\ub2e4. \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub294 \uacfc\uc815\uc5d0\uc11c \uba87 depth\uac00 \ub418\ub294 \uc790\uc2dd \uac1d\uccb4\ub97c \ubc14\ub85c \ubcc0\uacbd\ud558\ub294 \ucf00\uc774\uc2a4\uac00 \ub9ce\uc744 \uac83\uc774\uae30 \ub54c\ubb38\uc774\ub2e4. "),(0,a.kt)("p",null,"\ub530\ub77c\uc11c \ub2e4\uc74c\uacfc \uac19\uc740 \ubc29\ubc95\uc73c\ub85c \uc774\ub97c \ub300\uc751\ud55c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const origin = {};\nconst handler = {\n  set: function(target, prop, value) {\n    if (typeof value === 'number') {\n      target[prop] = value * 2;\n    } else {\n      Reflect.set(...arguments);\n    }\n  },\n  // highlight-start\n  get: function(target, prop) {\n    if (typeof target[prop] === 'object') {\n      return new Proxy(target[prop], handler);\n    }\n    \n    return Reflect.get(...arguments);\n  }\n  // highlight-end\n}\n\nconst proxy = new Proxy(origin, handler);\n\nproxy.b = {};\nproxy.b.c = {};\nproxy.b.c.d = 20;\n\nconsole.log(proxy.b.c); // Proxy {}\nconsole.log(proxy.b.c.d); // 40\n")),(0,a.kt)("p",null,"Proxy\ub97c \ub9cc\ub4e4\ub54c set\ubfd0 \uc544\ub2c8\ub77c get\uc5d0\uc11c\ub3c4 \ucee4\uc2a4\ud140 \ub85c\uc9c1\uc744 \ucd94\uac00\ud55c\ub2e4. Proxy \uac1d\uccb4\uc5d0\uc11c \uac12\uc744 \uac00\uc838\uc62c \ub54c \uc77c\ubc18 \uac1d\uccb4\ub97c \uac00\uc838\uc628\ub2e4\uba74 Proxy \uac1d\uccb4\ub97c \ub9cc\ub4e4\uc5b4\uc11c \uac00\uc838\uc624\uac8c\ub054 \ud558\ub294 \uac83\uc774\ub2e4.\n\uc774\ub807\uac8c \ub418\uba74, ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy")," \uac1d\uccb4\ub3c4 Proxy \uac1d\uccb4\uc774\uace0, ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.b"),"\ub3c4 ",(0,a.kt)("inlineCode",{parentName:"p"},"handler.get"),"\uc744 \uc0ac\uc6a9\ud574\uc11c \uc77c\ubc18\uac1d\uccb4\uac00 \uc544\ub2cc Proxy\uac1d\uccb4\ub97c \ubc18\ud658\ud55c\ub2e4.\n\ub530\ub77c\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.b.c"),"\uc5d0 20\uc744 \ud560\ub2f9\ud55c\ub2e4\uba74, ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.b"),"\ub294 Proxy \uac1d\uccb4\uc774\ubbc0\ub85c ",(0,a.kt)("inlineCode",{parentName:"p"},"handle.set")," \ub85c\uc9c1\uc744 \uc0ac\uc6a9\ud558\uc5ec ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.b.c"),"\uc5d0\ub294 20\uc774 \uc544\ub2cc 40\uc774 \ud560\ub2f9\ub418\uac8c \ub418\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("p",null,"\uc774\ub7ec\ud55c get\uacfc set\uc758 \ub3d9\uc791\uc744 \uc774\uc6a9\ud574\uc11c immer\uc5d0\uc11c\ub294 get\uc5d0\uc11c\ub294 \uae4a\uc219\ud55c \uac1d\uccb4\ub97c \ucc38\uc870\ud560\ub54c\uc5d0\ub3c4 Proxy\ub97c \ucc38\uc870\ud560 \uc218 \uc788\uac8c\ub054,\nset\uc5d0\uc11c\ub294 \uac1d\uccb4\ub97c \uc9c1\uc811 \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub97c \uc774\uc6a9\ud558\ub294 \ub85c\uc9c1\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4. \ub2e4\uc74c \ucc55\ud130\uc5d0\uc11c \uc5b4\ub5bb\uac8c \uad6c\ud604\ub418\uc5b4 \uc788\ub294\uc9c0 \uc54c\uc544\ubcf4\uc790."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("mdxAdmonitionTitle",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"latest"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"peek"),"\uc5d0 \ub300\ud574\uc11c"),(0,a.kt)("p",{parentName:"admonition"},"\uc55e\uc73c\ub85c\uc758 immer\ucf54\ub4dc\uc5d0\uc11c immer\uc5d0\uc11c \uc4f0\uc774\ub294 \uc720\ud2f8 \ud568\uc218\uc778 ",(0,a.kt)("inlineCode",{parentName:"p"},"latest"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"peek"),"\uc5d0 \ub300\ud574\uc11c \ub9ce\uc774 \ud655\uc778\ud558\uac8c \ub420 \uac83 \uc774\ub2e4.\n\uc774 \uc720\ud2f8 \ud568\uc218\uac00 \uc5b4\ub5a4 \ub3d9\uc791\uc744 \ud558\ub294\uc9c0 \uad81\uae08\ud558\ub2e4\uba74 \uc0b4\ud3b4\ubcf4\uc790."),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"latest")),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/master/src/utils/common.ts#L160-L162\nexport function latest(state) {\n  return state.copy_ || state.base_\n}\n")),(0,a.kt)("p",{parentName:"admonition"},"state\ub294 produce\uc5d0\uc11c \uc0dd\uc131\ud55c proxy \uac1d\uccb4\uc774\ub2e4. proxy \uac1d\uccb4\ub294 meta data\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"new Proxy"),"\ub85c \uc0dd\uc131\ud55c \uac1d\uccb4\ub97c \uac00\uc9c0\uace0 \uc788\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"latest"),"\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_")," \ud639\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_")," \uac1d\uccb4\ub97c \uac00\uc838\uc624\ub294\ub370, \ud604\uc7ac proxy\uac00 \uac00\uc9c0\uace0 \uc788\ub294 \ub370\uc774\ud130\ub97c \uac00\uc838\uc624\ub294\ub370 \uc4f0\uc774\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub294 \ubcc0\uacbd\ub41c \ucd5c\uc2e0 \uac1d\uccb4\uc774\uace0, ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\ub294 \uc6d0\ubcf8 \uac1d\uccb4\uc774\ubbc0\ub85c ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub97c \uba3c\uc800 \uac00\uc838\uc624\ub294 \uac83\uc744 \uc6b0\uc120\uc2dc\ud558\uace0 \uc788\ub2e4."),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"peek")),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/master/src/core/proxy.ts#L234-L238\nexport function peek(draft, prop) {\n  const state = draft[DRAFT_STATE];\n  const source = state ? latest(state) : draft;\n  return source[prop]\n}\n")),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"peek"),"\ub294 \uac1d\uccb4\uc5d0\uc11c \ud2b9\uc815 key\uc5d0 \ub300\ud55c \uac12\uc744 \uac00\uc838\uc624\ub294 \uc5ed\ud560\uc744 \ud55c\ub2e4. \uc989, draft\uc5d0\uc11c prop\ub97c key\ub85c \uac00\uc9c0\ub294 \uac12\uc744 \uac00\uc838\uc624\uae30 \uc704\ud574 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774\ub2e4.\n\uc5ec\uae30\uc11c\ub294 3\uac00\uc9c0 \uacbd\uc6b0\uac00 \uc874\uc7ac\ud55c\ub2e4."),(0,a.kt)("ol",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ol"},"draft\uac00 Proxy\uac1d\uccb4\uac00 \uc544\ub2c8\ub77c \uc77c\ubc18 \uac1d\uccb4\uc778 \uacbd\uc6b0 ",(0,a.kt)("br",null),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\uc774 \uacbd\uc6b0\ub294 ",(0,a.kt)("inlineCode",{parentName:"li"},"draft[DRAFT_STATE]"),"\uac00 ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined")," \uc774\uae30 \ub54c\ubb38\uc5d0 draft","[prop]"," \ub97c \ucc38\uc870\ud574\uc11c \ubc14\ub85c \ub9ac\ud134\ud55c\ub2e4."))),(0,a.kt)("li",{parentName:"ol"},"draft\uac00 Proxy \uac1d\uccb4\uc774\uace0 ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_")," \ub97c \uac16\uace0 \uc788\uc744 \uacbd\uc6b0",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"copy_.[prop]"),"\ub97c \ub9ac\ud134\ud55c\ub2e4."))),(0,a.kt)("li",{parentName:"ol"},"draft\uac00 Proxy \uac1d\uccb4\uc774\uace0 ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_")," \ub97c \uac16\uace0 \uc788\uc9c0 \uc54a\uc740 \uacbd\uc6b0",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"base_.[prop]"),"\ub97c \ub9ac\ud134\ud55c\ub2e4.")))),(0,a.kt)("p",{parentName:"admonition"},"\uc989, \uc5ec\ub7ec \uacbd\uc6b0\uc5d0 \ub300\ud574\uc11c object(\ud639\uc740, proxy)\uc5d0\uc11c key\uc5d0 \ub9de\ub294 \uac12\uc744 \uad6c\ud558\uae30 \uc704\ud55c \uc720\ud2f8 \ud568\uc218 \uc778 \uac83\uc774\ub2e4.")),(0,a.kt)("h3",{id:"traps-of-immer"},"Traps of immer"),(0,a.kt)("p",null,"immer\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"Proxy"),"\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 get\uc740 multi depth\uc758 \uac1d\uccb4\ub97c \ucc38\uc870\ud588\uc744\ub54c\uc5d0\ub3c4 Proxy\ub97c \ucc38\uc870\ud560 \uc218 \uc788\uac8c Proxy\ub97c \uc0dd\uc131\ud574\uc8fc\ub294 \uc5ed\ud560\uc744 \uac00\uc9c0\uace0 \uc788\uace0,\nset\uc740 \uc6d0\ubcf8 \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub824 \ud560 \ub54c \uc774\ub97c \ub9c9\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\uc640 \uac19\uc740 \uba54\ud0c0 \ub370\uc774\ud130\ub97c \uc81c\uc5b4\ud558\ub3c4\ub85d \ud558\ub294 \uc5ed\ud560\uc744 \uac00\uc9c0\uace0 \uc788\ub2e4."),(0,a.kt)("h4",{id:"get"},"Get"),(0,a.kt)("p",null,"get \ub85c\uc9c1\uc758 \ubaa9\uc801\uc740 deep\ud55c tree\uc5d0 \uc811\uadfc\ud558\uc5ec set\uc744 \ud558\ub354\ub77c\ub3c4 proxy\uac1d\uccb4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ub9cc\ub4e4\uc5b4\uc8fc\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/master/src/core/proxy.ts#L101-L124\nexport const objecTraps = {\n  get(state, prop) {\n    if (prop === DRAFT_STATE) return state;\n\n    const source = latest(state);\n    const value = source[props];\n    \n    if (state.finalized_ || !isDraftable(value)) return value    \n\n    if (value === peek(state.base_, prop)) {\n      prepareCopy(state);\n      return state.copy_[prop] = createProxy(state.scope_.immer_, value, state)\n    }\n    \n    return value\n  }\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"if (prop === DRAFT_STATE) return state;\n")),(0,a.kt)("p",null,"\uac00\uc7a5 \uba3c\uc800 \ubcf4\uc774\ub294 DRAFT_STATE \ube44\uad50 \ub85c\uc9c1\uc740 immer\uc5d0\uc11c draft\ub97c \ubc14\ub85c \ud68d\ub4dd\ud558\uae30\uc704\ud55c hole\uac19\uc740 \ub3d9\uc791\uc73c\ub85c \ubcf4\uc778\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"peek")," \uc640 \uac19\uc740 \uc720\ud2f8\ud568\uc218\uc5d0\uc11c proxy\uac1d\uccb4\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"draft[DRAFT_STATE]"),"\ub97c \ud638\ucd9c\ud574\uc11c proxy \uadf8 \uc790\uccb4\ub97c \uac00\uc838\uc624\ub294 \uac83\uc744 \ud655\uc778 \ud560 \uc218 \uc788\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const source = latest(state);\nconst value = source[prop];\n    \nif (state.finalized_ || !isDraftable(value)) return value  \n")),(0,a.kt)("p",null,"\ub2e4\uc74c \ub85c\uc9c1\uc740, proxy \uac1d\uccb4\ub97c \ub9cc\ub4e4 \ud544\uc694\uac00 \uc5c6\ub294 \uacbd\uc6b0\uc5d0 \ub300\ud55c \ubd84\uae30\uc774\ub2e4.\nstate\uac00 ",(0,a.kt)("inlineCode",{parentName:"p"},"finalized")," \uc0c1\ud0dc, \uc989 \ub370\uc774\ud130\uac00 \ubaa8\ub450 \uc5c5\ub370\uc774\ud2b8 \ub418\uc5b4 return\ud560 \uc900\ube44\uac00 \ub41c \uc0c1\ud0dc\ub77c\uba74 proxy\ub85c \ubcc0\uacbd\ud560 \ud544\uc694\uac00 \uc5c6\uace0,\nvalue\uac00 ",(0,a.kt)("inlineCode",{parentName:"p"},"isDraftable"),", \uc989 mutable\ud55c \uc18d\uc131\uc744 \uac00\uc9c0\ub294 object\ub098 array \uac19\uc740 \ud0c0\uc785\uc774 \uc544\ub2cc \uacbd\uc6b0\ub294 proxy\ub85c \ub9cc\ub4e4 \uc774\uc720\uac00 \uc5c6\uc73c\ubbc0\ub85c \uadf8\ub300\ub85c \ub9ac\ud134\uc744 \ud55c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"if (value === peek(state.base_, prop)) {\n  prepareCopy(state);\n  return state.copy_[prop] = createProxy(state.scope_.immer_, value, state)\n}\n\nreturn value\n")),(0,a.kt)("p",null,"\uc774\uc81c\ub294 proxy \uac1d\uccb4\ub97c \ub9cc\ub4e4\ub54c\uc758 \ub85c\uc9c1\uc774\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy")," \ub97c \ud638\ucd9c\ud558\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\uc5d0 \uc790\uc2dd proxy\ub97c \uc0dd\uc131\ud55c\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"state.base_"),"\ub97c ",(0,a.kt)("inlineCode",{parentName:"p"},"state.copy_"),"\ub85c shallow copy\ub97c \ud558\ub294 \ud568\uc218\uc774\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"state.copy_"),"\ub97c \ubcf5\uc0ac\ud574\uc11c \ub9cc\ub4e4\uace0, ",(0,a.kt)("inlineCode",{parentName:"p"},"state.copy_[prop]"),"\uc5d0 \uc0c8\ub85c\uc6b4 proxy\ub97c \uc0dd\uc131\ud558\uc5ec \uc800\uc7a5\ud55c\ub2e4.\n\uc774\ub54c\ubd80\ud130 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\uac00 \uac00\uc9c0\uace0 \uc788\ub294 \uac12\ub4e4\uc774 \uac19\uc9c0 \uc54a\uac8c \ub41c\ub2e4. "),(0,a.kt)("p",null,"\uc774\ub7ec\ud55c \ub85c\uc9c1\uc744 \ud1b5\ud574\uc11c deep tree\ub97c \ucc38\uc870\ud558\ub354\ub77c\ub3c4 \uac1d\uccb4\uc778 \uacbd\uc6b0 proxy\ub97c \uac00\uc838\uc62c \uc218 \uc788\ub3c4\ub85d \uad6c\ud604\ud574\ub193\uc558\ub2e4."),(0,a.kt)("p",null,"\uc790 \uadf8\ub807\ub2e4\uba74, \ud55c\ubc88 get\uc73c\ub85c proxy\ub97c \ub9cc\ub4e0 \uac1d\uccb4\ub97c \ub2e4\uc2dc \ucc38\uc870\ud558\uba74 \ub2e4\uc2dc proxy \uac1d\uccb4\ub97c \ub9cc\ub4e4\uae4c?\n\ub2f9\uc5f0\ud55c \ub9d0\uc774\uc9c0\ub9cc \ud55c\ubc88 proxy\ub97c \ub9cc\ub4e0 \uac1d\uccb4\ub77c\uba74 \uae30\uc874\uc5d0 \ub9cc\ub4e4\uc5b4 \ub454 \uac83\uc744 \uc7ac\uc0ac\uc6a9\ud55c\ub2e4.\n\uc7ac\uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c\ub054 \uac80\uc0ac\ub97c \ud558\ub294 \ub85c\uc9c1\uc774  ",(0,a.kt)("inlineCode",{parentName:"p"},"value === peek(state.base_, prop)")," \uc758 \ubd84\uae30\uc774\ub2e4."),(0,a.kt)("h5",{id:"\uc774\ubbf8-\uc0dd\uc131\ud55c-proxy\uc758-\uc7ac\uc0ac\uc6a9-value--peekstatebase_-prop"},"\uc774\ubbf8 \uc0dd\uc131\ud55c proxy\uc758 \uc7ac\uc0ac\uc6a9 (",(0,a.kt)("inlineCode",{parentName:"h5"},"value === peek(state.base_, prop)"),")"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"peek(state.base_, prop)"),"\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc758 prop\ub97c \uc758\ubbf8\ud558\uace0, ",(0,a.kt)("inlineCode",{parentName:"p"},"value"),"\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_")," \ud639\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc758 prop\ub97c \uc758\ubbf8\ud55c\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\uac00 \uc0dd\uc131\ub418\uae30 \uc804, \uc989 get\uc744 \ud55c \uc801\uc774 \uc5c6\ub2e4\uba74 \ud56d\uc0c1 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\ub97c \ube44\uad50\ud558\ubbc0\ub85c \ud56d\uc0c1 true\uc774\uace0 proxy\ub97c \ub9cc\ub4dc\ub294 \ub85c\uc9c1\uc744 \ud56d\uc0c1 \uc2e4\ud589 \ud560 \uac83\uc774\ub2e4.\n\ud558\uc9c0\ub9cc, get\uc744 \ud55c \uc801\uc774 \uc788\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\uac00 \ub9cc\ub4e4\uc5b4\uc9c4 \uc0c1\ud0dc\ub77c\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_")," \uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\ub97c \ube44\uad50\ud55c\ub2e4.\n\uc774\uc804 get\ub85c\uc9c1\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_[prop]"),"\uc5d0 proxy\ub97c \ud560\ub2f9\ud558\uc5ec \uc774\ubbf8 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc640 \uac12\uc774 \ub2ec\ub77c\uc84c\uae30 \ub54c\ubb38\uc5d0 proxy\ub97c \ub9cc\ub4dc\ub294 \ub85c\uc9c1\uc744 \uc2a4\ud0b5\ud558\uace0 \uadf8\ub300\ub85c ",(0,a.kt)("inlineCode",{parentName:"p"},"state.copy_"),"\ub97c \ub9ac\ud134\ud55c\ub2e4.\n\uc774\ub7ec\ud55c \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud574\uc11c get\uc5d0\uc11c \ubd88\ud544\uc694\ud558\uac8c proxy\ub97c \uc0dd\uc131\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uace0 \uc788\ub2e4."),(0,a.kt)("p",null,"\ucf54\ub4dc\ub85c \ud55c\uc904\uc529 \uc124\uba85\ud558\ub2c8 \ubcf5\uc7a1\ud55c\ub370, proxy\uc758 get\ub3d9\uc791\uc5d0\uc11c \ud558\ub294 \uc77c\uc744 \uc694\uc57d\ud574\ubcf4\uc790."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\uac1d\uccb4\uc5d0\uc11c \ucc38\uc870\ud558\ub294 \uac12\uc774 object\uac00 \uc544\ub2cc \uacbd\uc6b0 \uadf8\ub300\ub85c \uac12\uc744 \ub9ac\ud134\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ol"},"\uac1d\uccb4\uc5d0\uc11c \ucc38\uc870\ud558\ub294 \uac12\uc774 object\uc77c \uacbd\uc6b0 proxy\ub97c \ub9cc\ub4e4\uc5b4\uc11c \ub9ac\ud134\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ol"},"\ub9cc\uc57d \ud55c\ubc88 \ucc38\uc870\ud55c \uc801\uc774 \uc788\ub294 object\ub77c\uba74 \uc774\uc804\uc5d0 \ub9cc\ub4e4\uc5b4\ub454 proxy\ub97c \uc7ac\uc0ac\uc6a9\ud55c\ub2e4.")),(0,a.kt)("h4",{id:"set"},"Set"),(0,a.kt)("p",null,"set \ub85c\uc9c1\uc758 \ubaa9\uc801\uc740 \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\uace0 \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc5c8\ub2e4\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_")," flag\ub97c \uc124\uc815\ud558\ub294 \ubaa9\uc801\uc744 \uac00\uc9c4\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/master/src/core/proxy.ts#L131-L173\nexport const objectTraps = {\n  set(state, prop, value) {\n    if (!state.modified_) {\n      const current = peek(latest(state), prop)\n      const currentState = current?.[DRAFT_STATE]\n      \n      if (is(value, current) && has(state.base_, prop)) return;\n\n      prepareCopy(state);\n      markChanged(state);\n    }\n\n    if (state.copy[props] === value) return;\n\n    state.copy_[props] = value;\n    return;\n  }\n} \n")),(0,a.kt)("p",null,"set\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \uc8fc\uc694 \ub85c\uc9c1\uc744 \ucd95\uc57d\ud558\uba74 \uc704\uc640 \uac19\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"set() {\n  ...\n  if (state.copy[props] === value) return;\n\n  state.copy_[props] = value;\n  return;  \n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"modified_")," \uc5ec\ubd80\uc5d0 \uad00\uacc4\uc5c6\uc774 \uc9c4\ud589\ud558\ub294 \ub85c\uc9c1\uc744 \ubcf4\uba74 set\uc744 \ud560 \ub54c original data(",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),")\ub97c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub9cc\uc744 \ubcc0\uacbd\uc2dc\ud0a4\ub294 \uac83\uc744 \ud655\uc778 \ud560 \uc218 \uc788\ub2e4.\n\uc774 \uacfc\uc815\uc5d0\uc11c \uc0c8\ub85c\uc6b4 \uac12\uc774 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\uc5d0 \uc800\uc7a5\ub418\uc5b4 \uc788\ub294 \uac12\uacfc reference\uac00 \uac19\ub2e4\uba74 \uc5c5\ub370\uc774\ud2b8\ub97c \uc9c4\ud589\ud558\uc9c0 \uc54a\ub294\ub2e4. \uc774\ub85c\uc368 \ubd88\ud544\uc694\ud55c \uc5c5\ub370\uc774\ud2b8\ub294 \ubc29\uc9c0\ud558\uace0 \uc788\ub294 \uac83\ub3c4 \ud655\uc778 \ud560 \uc218 \uc788\ub2e4."),(0,a.kt)("p",null,"\ub9cc\uc57d, \uc5c5\ub370\uc774\ud2b8 \ub420 \uac1d\uccb4\uac00 \ubcc0\uacbd\ub41c \uc774\ub825\uc774 \uc5c6\ub2e4\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\uac00 false\uc77c \ud150\ub370, set \ub85c\uc9c1\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_")," flag\uac00 \ubcc0\uacbd\ub41c\ub2e4. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"set(state, prop, value) {\n  if (!state.modified_) {\n    const current = peek(latest(state), prop)\n    const currentState = current?.[DRAFT_STATE]\n    \n    if (is(value, current) && has(state.base_, prop)) return;\n\n    // highlight-start\n    prepareCopy(state);\n    markChanged(state);\n    // highlight-end\n  }\n  ...\n}\n")),(0,a.kt)("p",null,"set\uc744 \uc9c4\ud589\ud560 \ub54c ",(0,a.kt)("inlineCode",{parentName:"p"},"modified"),"\uac00 false \uc0c1\ud0dc\ub77c\uba74 \ubcc0\uacbd \ub85c\uc9c1\uc744 \uc9c4\ud589\ud55c\ub2e4. edge\ub85c\uc9c1\uc744 \uc81c\uc678\ud558\uace0 \uae30\ubcf8\ub85c\uc9c1\ub9cc \ubcf8\ub2e4\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"markChanged")," \ud568\uc218\ub97c \uc2e4\ud589\ud55c\ub2e4."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("h4",{parentName:"admonition",id:"get\uc5d0\uc11c\uc758-preparecopy\uc640-set\uc5d0\uc11c\uc758-preparecopy"},"get\uc5d0\uc11c\uc758 ",(0,a.kt)("inlineCode",{parentName:"h4"},"prepareCopy"),"\uc640 set\uc5d0\uc11c\uc758 ",(0,a.kt)("inlineCode",{parentName:"h4"},"prepareCopy")),(0,a.kt)("p",{parentName:"admonition"},"\uc774\uc804\uc5d0 get\uc744 \uc9c4\ud589\ud560 \ub54c ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub97c \uc0ac\uc6a9\ud558\ub294 \uac78 \ubcf4\uc558\ub2e4. get\ud560\ub54c copy\ub97c \uc9c4\ud589\ud558\uace0 set\ud560\ub54c\ub3c4 copy\ub97c \uc9c4\ud589\ud558\ub294\uac78\uae4c?"),(0,a.kt)("p",{parentName:"admonition"},"\uc790\uc138\ud788\ubcf4\uba74 get\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\uc640 set\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub294 \ubaa9\uc801\uc774 \ub2e4\ub974\ub2e4.\nget\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub294 \ucc38\uc870\ud560 \uac1d\uccb4\uc758 \ubd80\ubaa8\uac1d\uccb4\ub97c copy\ud558\ub294 \ub3d9\uc791\uc744 \ud558\uace0, set\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub294 \ucc38\uc870\ud558\ub294 \uac1d\uccb4 \ubcf8\uc778\ub97c copy\ud558\ub294 \ub3d9\uc791\uc744 \ud55c\ub2e4.\n\uc608\ub97c\ub4e4\uc5b4, \ub9cc\uc57d ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.a.b = { ... }"),"\ub85c \uac1d\uccb4\ub97c \ubcc0\uacbd\ud55c\ub2e4\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.a")," \uae4c\uc9c0\ub294 get\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub97c \ud1b5\ud574 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub97c \ub9cc\ub4e4\uace0,\n",(0,a.kt)("inlineCode",{parentName:"p"},"proxy.a.b"),"\ub294 set\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"prepareCopy"),"\ub97c \ud1b5\ud574 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub97c \ub9cc\ub4e0\ub2e4.")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"markChanged"),"\uc758 \ucf54\ub4dc\ub294 \ub2e4\uc74c\uacfc \uac19\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/proxy.ts#L266-L273\nexport function markChanged(state: ImmerState) {\n  if (!state.modified_) {\n    state.modified_ = true\n    if (state.parent_) {\n      markChanged(state.parent_)\n    }\n  }\n}\n")),(0,a.kt)("p",null,"\ubcf8\uc778\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\ub97c \ubcc0\uacbd\ud558\ub294 \uac83\uacfc \ub354\ubd88\uc5b4 \ubd80\ubaa8\uac1d\uccb4\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\ub97c \ud1b5\ud574 root proxy\uae4c\uc9c0\uc758 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\ub97c \ubcc0\uacbd\ud55c\ub2e4.\n\uc774\ub807\uac8c root proxy\uae4c\uc9c0 \ubcc0\uacbd\ud568\uc73c\ub85c\uc368 root\ubd80\ud130 leaf\uae4c\uc9c0 \uc5b4\ub5a4 \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c \ucc3e\uc544 \uac08 \uc218 \uc788\ub2e4."),(0,a.kt)("p",null,"\ucd94\uac00\ub85c \uc911\uac04\uc5d0 \ube60\ub728\ub838\ub358 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified")," \ubcc0\uacbd\uc2dc\uc758 edge case\ub97c \ud655\uc778\ud574\ubcf4\uc790."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"set(state, prop, value) {\n  if (!state.modified_) {\n    // highlight-start\n    const current = peek(latest(state), prop)\n    const currentState = current?.[DRAFT_STATE]\n    \n    if (is(value, current) && has(state.base_, prop)) return;\n    // highlight-end\n\n    prepareCopy(state);\n    markChanged(state);\n  }\n  ...\n")),(0,a.kt)("p",null,"\ubcc0\uacbd \ub420 \uac12(value)\uacfc \uc800\uc7a5\ub418\uc5b4 \uc788\ub294 \uac12(current)\uc774 \uac19\uace0, ",(0,a.kt)("inlineCode",{parentName:"p"},"base_[prop]"),"\uac00 \uac12\uc774 \uc788\ub2e4\uba74 \ubcc0\uacbd \ud560 \ud544\uc694\uac00 \uc5c6\ub2e4\uace0 \ud310\ub2e8\ud558\uace0\n",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\ub97c true\ub85c \ub9cc\ub4dc\ub294 \uacfc\uc815\uc744 \uc911\ub2e8\ud558\uace0 \uc5c5\ub370\uc774\ud2b8\ub97c \uc9c4\ud589\ud558\uc9c0 \uc54a\ub294\ub2e4. \uac19\uc740 \uac12\uc744 \ud560\ub2f9\ud588\uc744\ub54c modified_\ub97c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uc74c\uc73c\ub85c\uc368\n\ubd88\ud544\uc694\ud55c \uc5f0\uc0b0\uc744 \uc904\uc774\ub824\ub294 \ub178\ub825\uc73c\ub85c \ubcf4\uc778\ub2e4."),(0,a.kt)("p",null,"\uc790 \uc774\uc81c set\uc758 \ub85c\uc9c1\uc744 \uc694\uc57d\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\ub2e4."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"modified_"),"\uac00 false\ub77c\uba74 \uc790\uc2e0\uc758 ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),"\ub97c ",(0,a.kt)("inlineCode",{parentName:"li"},"base_"),"\uc5d0\uc11c \ubcf5\uc0ac\ud574\uc8fc\uace0 \uc790\uc2e0 \ud3ec\ud568 \ubd80\ubaa8\ubd80\ud130 \ub8e8\ud2b8\uae4c\uc9c0\uc758 ",(0,a.kt)("inlineCode",{parentName:"li"},"modified_"),"\ub97c true\ub85c \ub9cc\ub4e4\uc5b4\uc900\ub2e4."),(0,a.kt)("li",{parentName:"ol"},"modified \uc5ec\ubd80\uc640 \uad00\uacc4\uc5c6\uc774 ",(0,a.kt)("inlineCode",{parentName:"li"},"state.copy_"),"\uc5d0 \ubcc0\uacbd\ud560 \uac12\uc744 \ud560\ub2f9\ud574\uc900\ub2e4.")),(0,a.kt)("h3",{id:"recap-of-proxy"},"Recap of Proxy"),(0,a.kt)("p",null,"immer\uc5d0\uc11c Proxy\uac1d\uccb4\uac00 \ud558\ub294 \uc5ed\ud560\uc744 \uc815\ub9ac\ud574\ubcf4\uc790."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\ub370\uc774\ud130\ub97c \ucc38\uc870\ud560\ub54c \uac1d\uccb4\ub77c\uba74 Proxy \uac1d\uccb4\ub97c \uc0dd\uc131\ud574\uc900\ub2e4. \uac1d\uccb4\uc5d0\uc11c \uc5ec\ub7ec\ubc88 multi depth\ub85c \ucc38\uc870\ub97c \ud588\uc744\ub54c  get\uc740 \uc21c\ucc28\uc801\uc73c\ub85c \uc9c4\ud589\ub418\uae30 \ub54c\ubb38\uc5d0 root \uac1d\uccb4\ubd80\ud130 target \uac1d\uccb4\uae4c\uc9c0 \ud1b5\ud558\ub294 \ubaa8\ub4e0 \uac1d\uccb4\uac00 proxy\ub85c \uc0dd\uc131\ub418\uac8c \ub41c\ub2e4. \ub355\ubd84\uc5d0 multi depth\ub85c \uac1d\uccb4\ub97c \ucc38\uc870\ud558\uc600\uc744\ub54c\ub3c4 root\uc640 \ub3d9\uc77c\ud55c Proxy \ub85c\uc9c1\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"\ub370\uc774\ud130\ub97c \ud560\ub2f9\ud560\ub54c\uc5d0\ub294 ",(0,a.kt)("inlineCode",{parentName:"li"},"base_"),"\ub97c ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),"\ub85c \uc595\uc740 \ubcf5\uc0ac\ub97c \ud558\uace0 ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_")," \uac1d\uccb4\uc5d0 \ubcc0\uacbd\ub418\ub294 \uac12\uc744 \uc5c5\ub370\uc774\ud2b8\ud55c\ub2e4. \uc774\ub54c, \ubcc0\uacbd\ub41c \uc801 \uc5c6\ub294 \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub294 \uac83\uc774\ub77c\uba74 \ud574\ub2f9 \uac1d\uccb4\ubd80\ud130 \ubd80\ubaa8 \uac1d\uccb4\ub97c \uac70\uccd0 root \uac1d\uccb4\uae4c\uc9c0 modified\ub97c \ubaa8\ub450 true\ub85c \uc124\uc815\ud55c\ub2e4.")),(0,a.kt)("h2",{id:"finalize"},"finalize"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"recipe")," \ud568\uc218\ub97c \ud1b5\ud574\uc11c \ub370\uc774\ud130\ub97c \ubaa8\ub450 \ubcc0\uacbd\ud558\uc600\ub2e4\uba74 \uc774\uc81c finalize \uacfc\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub4e4\uc744 \uc801\uc808\ud558\uac8c \ud569\uccd0\uc8fc\ub294 \uacfc\uc815\uc778 \uac83\uc774\ub2e4.\n\ub2e4\uc2dc produce \ucf54\ub4dc\ub97c \ubcf4\uc790\uba74 \ub2e4\uc74c\uacfc \uac19\ub2e4. ",(0,a.kt)("br",null),"\n\uc5ec\uae30\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"return processResult(result, scope)")," \uc5d0 \ub300\ud55c \ub85c\uc9c1\uc744 \ud655\uc778\ud558\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/immerClass.ts#L66-L122\nexport class Immer {\n  produce: (base, recipe) {\n    let result;\n\n    const scope = enterScope(this);\n    const proxy = createProxy(this, base, undefined);\n    \n    result = recipe(proxy);\n    // highlight-start\n    return processResult(result, scope);\n    // highlight-end\n  }\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/finalize.ts#L22-L56\nexport function processResult(result, scope) {\n  const baseDraft = scope.drafts_[0];\n  const isReplaced = result !== undefined;\n  \n  if (isReplaced) {\n    result = finalize(scope, result);\n  } else {\n    result = finalize(scope, baseDraft, []);\n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"finalize"),"\uacfc\uc815\uc740 \ud06c\uac8c \ub450\uac00\uc9c0\ub85c \ub098\ub25c\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\uc5d0\uc11c return\uc744 \ud558\ub294 \uacbd\uc6b0\uc640 \uc544\ub2cc \uacbd\uc6b0\uc774\ub2e4.\n\uc774 \ub450\uac00\uc9c0\uc758 \ucc28\uc774\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"finalize")," \ud568\uc218\ub85c \ub123\uc5b4\uc8fc\ub294 \ubcc0\uc218\uc5d0 \uc788\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\uac00 return\uc744 \ud558\uace0 \uc788\ub2e4\uba74 result\uac12\uc744 \uae30\uc900\uc73c\ub85c finalize\ub97c \uc9c4\ud589\ud558\uace0,\n",(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\uac00 return\uc744 \ud558\uc9c0 \uc54a\uc73c\uba74 root proxy\ub97c \uae30\uc900\uc73c\ub85c finalize\ub97c \uc9c4\ud589\ud55c\ub2e4."),(0,a.kt)("h3",{id:"root-proxy\ub97c-\uc0ac\uc6a9\ud558\ub294-finalize"},"root proxy\ub97c \uc0ac\uc6a9\ud558\ub294 finalize"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\uac00 return\uc744 \ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 \uc790\ub3d9\uc73c\ub85c root proxy\ub97c \uc0ac\uc6a9\ud574\uc11c finalize\ub97c \uc9c4\ud589\ud55c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/finalize.ts#L57-L110\nfunction finalize(rootScope, value, path) {\n  ...\n  if (!state.modified_) {\n    return state.base_;\n  }\n  \n  if (!state.finalized_) {\n    state.finalized_ = true;\n    const result = state.copy_;\n    \n    each(result, (key, childValue) => finalizeProperty(...));\n  }\n  \n  return state.copy_;\n}\n")),(0,a.kt)("p",null,"\uc5ec\uae30\uc11c value\ub294 root proxy\ub97c \uc758\ubbf8\ud55c\ub2e4. \ub9cc\uc57d root proxy\uac00 ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\ub97c false\ub85c \uac16\uace0\uc788\ub2e4\uba74 \ub0b4\ubd80 \uac1d\uccb4\ub294 \ud55c\ubc88\ub3c4 \ubcc0\uacbd\ub41c \uc801\uc774 \uc5c6\ub2e4\ub294 \uc758\ubbf8\uc774\ub2e4.\n\ub530\ub77c\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"state.base_"),"\ub97c \uadf8\ub300\ub85c \ub9ac\ud134\ud55c\ub2e4. \ubcc0\uacbd\ub41c \uc801\uc774 \uc788\uc5b4\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\uac00 true\ub77c\uba74  ",(0,a.kt)("inlineCode",{parentName:"p"},"finalized_"),"\ub97c \ud655\uc778\ud55c\ub2e4. finalize\ub97c \uc5ec\ub7ec\ubc88 \ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud568\uc774\uba70,\nfinalized \ub85c\uc9c1\uc744 \ub4e4\uc5b4\uac00\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"finalized_"),"\ub97c true\ub85c \ubcc0\uacbd\ud558\uace0 \ub85c\uc9c1\uc744 \uc9c4\ud589\ud55c\ub2e4. proxy\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 ES5 \ubaa8\ub4dc\ub77c\uba74 \uc5ec\ub7ec \ub85c\uc9c1\ub4e4\uc774 \uc9c4\ud589\ub418\uc9c0\ub9cc proxy\ubaa8\ub4dc\ub77c\uba74\n",(0,a.kt)("inlineCode",{parentName:"p"},"state.copy_"),"\ub97c \uadf8\ub300\ub85c \uc0ac\uc6a9\ud55c\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"each"),"\ub97c \ud3ec\ud568\ud55c ",(0,a.kt)("inlineCode",{parentName:"p"},"finalizeProperty"),"\ub294 root proxy \ub0b4\ubd80\uc5d0 \uc788\ub294 \uc790\uc2dd \uac1d\uccb4\ub4e4\uc744 \ubaa8\ub450 ",(0,a.kt)("inlineCode",{parentName:"p"},"finalize"),"\ud558\uae30 \uc704\ud55c \ub3d9\uc791\uc774\ub2e4.\n\ubaa8\ub4e0 \uc790\uc2dd \uac1d\uccb4\uc758 finalize\ub97c \uc644\ub8cc\ud558\uc600\ub2e4\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"state.copy_"),"\ub97c \ub9ac\ud134\ud568\uc73c\ub85c\uc368 immer\ub85c\uc9c1\uc774 \uc885\ub8cc\ub41c\ub2e4."),(0,a.kt)("h3",{id:"recipe\uc758-return\uc744-\uc0ac\uc6a9\ud558\ub294-finalize"},"recipe\uc758 return\uc744 \uc0ac\uc6a9\ud558\ub294 finalize"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"recipe"),"\uac00 return \uac12\uc744 \uac00\uc9c0\uace0 \uc788\ub2e4\uba74 return \uac12\uc744 \uc0ac\uc6a9\ud558\uc5ec finalize\ub97c \uc9c4\ud589\ud55c\ub2e4. \ubb3c\ub860 return \uac12\uc740 plain object\uc774\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// https://github.com/immerjs/immer/blob/v9.0.6/src/core/finalize.ts#L57-L110\nfunction finalize(rootScope, value, path) {\n  const state = value[DRAFT_STATE];\n  \n  if (!state) {\n    each(value, (key, childValue) => finalizeProperty(...))\n    return value;\n  }\n  ...\n}\n")),(0,a.kt)("p",null,"plain object\uc778 value\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"value[DRAFT_STATE]"),"\ub97c \ucc38\uc870\ud55c\ub2e4\uba74 undefined\uc77c \uc218 \ubc16\uc5d0 \uc5c6\ub2e4. \ub530\ub77c\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"if (!state)")," \ub85c\uc9c1\uc73c\ub85c \uc9c4\ud589\ub41c\ub2e4.\nroot proxy\ub97c \uc0ac\uc6a9\ud558\ub294 finalize\uc640 \ub3d9\uc77c\ud558\uac8c ",(0,a.kt)("inlineCode",{parentName:"p"},"finalizeProperty"),"\ub97c \ud1b5\ud574\uc11c \uc790\uc2dd \uac1d\uccb4\ub4e4\uc744 \ubaa8\ub450 finalize \uacfc\uc815\uc744 \uc9c4\ud589\ud55c \ub4a4 value\ub97c \ub9ac\ud134\ud55c\ub2e4."),(0,a.kt)("p",null,"\uc774\ub54c, \uc790\uc2dd \uac1d\uccb4 \ubaa8\ub450 proxy\uac1d\uccb4\uac00 \uc544\ub2cc plain object\ub77c\uace0 \uc0dd\uac01\ud560 \uc218 \uc788\ub294\ub370 ",(0,a.kt)("inlineCode",{parentName:"p"},"recipe")," \ub0b4\ubd80\uc5d0\uc11c \uc811\uadfc\ud558\ub294 \uac1d\uccb4\uc758 \uacbd\uc6b0 \ubaa8\ub450 Proxy\uc758 get \ub3d9\uc791\uc5d0 \uc758\ud574\uc11c\nproxy\ub85c \ubcc0\uacbd\ub418\uc5b4 \ub9ac\ud134\ub418\uae30 \ub54c\ubb38\uc5d0 root\ub294 proxy\uac00 \uc544\ub2c8\ub354\ub77c\ub3c4 \uc790\uc2dd \uac1d\uccb4\ub294 proxy\uc77c \uc218\ub3c4 \uc788\ub2e4. \ub530\ub77c\uc11c \uc790\uc2dd \uac1d\uccb4\uae4c\uc9c0 \ubaa8\ub450 finalize \ub97c \uc9c4\ud589\ud574\uc8fc\uc5b4\uc57c\ud55c\ub2e4."),(0,a.kt)("h2",{id:"recap-1"},"Recap"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"immer\ub294 baseState \uac1d\uccb4\uc640 recipe \ucf5c\ubc31\ud568\uc218\ub97c \ubc1b\uc544\uc11c recipe \ub0b4\ubd80 mutable\ud55c \ub85c\uc9c1\ub4e4\uc744 \ubaa8\ub450 \uc218\ud589\ud558\ub294\ub370, \uae30\uc874 \uac1d\uccb4\ub294 \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 \uc5c5\ub370\uc774\ud2b8 \ub41c \uc0c8\ub85c\uc6b4 \uac1d\uccb4\ub97c \ubc18\ud658\ud558\ub294 \uac83\uc774\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"immer\ub294 baseState\ub97c \ubc1b\uc73c\uba74 \uc6b0\uc120 baseState\ub97c Proxy\uac1d\uccb4\ub85c \ub9cc\ub4e4\uc5b4\uc11c \uad00\ub9ac\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"proxy \uac1d\uccb4\ub294 \uc5ec\ub7ec \uac12\uc744 \uac16\uace0\uc788\uc9c0\ub9cc ",(0,a.kt)("inlineCode",{parentName:"li"},"base_"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),"\ub450 \uac1d\uccb4\ub97c \ub0b4\ubd80\uc801\uc73c\ub85c \uad00\ub9ac\ud558\uba70 ",(0,a.kt)("inlineCode",{parentName:"li"},"base_"),"\ub294 original data, ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),"\ub294 updated data\ub85c\uc368 \uad00\ub9ac\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"\uc55e\uc5d0\uc11c \ub9cc\ub4e0 Proxy \uac1d\uccb4\ub85c recipe \ucf5c\ubc31 \ud568\uc218 \ub85c\uc9c1\uc744 \uc2e4\ud589\ud558\ub294\ub370, \uc5ec\uae30\uc11c mutable\ud55c \ub85c\uc9c1\uc744 mutable\ud558\uc9c0 \uc54a\uac8c \uc218\ud589\ud558\ub294 \ubc29\ubc95\uc740 Proxy\uc758 set\uacfc get \ub4f1 \uac1d\uccb4 \uae30\ubcf8 \ub3d9\uc791\ub4e4\uc744 intercept\ud558\uae30 \ub54c\ubb38\uc774\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"proxy\uc758 get\uc5d0\uc11c\ub294 \ub9cc\ub098\ub294 \uac1d\uccb4\ub97c \ubaa8\ub450 Proxy\ub85c \ub9ac\ud134\ud558\uc5ec \uac1d\uccb4 \uae4a\uc219\ud55c \uacf3\uc744 \ucc38\uc870\ud558\ub354\ub77c\ub3c4 Proxy\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ub9cc\ub4e0\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"Proxy\uc758 set\uc5d0\uc11c\ub294 Proxy\uac1d\uccb4 \ub0b4\ubd80\uc5d0\uc11c \uad00\ub9ac\ud558\uace0 \uc788\ub294 ",(0,a.kt)("inlineCode",{parentName:"li"},"modified_")," flag\ub97c \ubcf4\uace0 \ubcc0\uacbd \uc5ec\ubd80\ub97c \uad00\ub9ac\ud558\uba70 ",(0,a.kt)("inlineCode",{parentName:"li"},"base_"),"\uac1d\uccb4\uac00 \uc544\ub2cc ",(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),"\uac1d\uccb4\ub97c \uc5c5\ub370\uc774\ud2b8\ud55c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"immer\uc5d0\uc11c Proxy\uc758 set, get\uc744 \ud65c\uc6a9\ud574\uc11c recipe \ub85c\uc9c1\uc744 \ubaa8\ub450 \uc218\ud589\ud558\uace0\ub098\uba74 Proxy\uac1d\uccb4\uc758 \uc815\ubcf4\ub97c \uc774\uc6a9\ud574\uc11c \ubcc0\uacbd\ub41c \uac1d\uccb4\ub294 \uc5c5\ub370\uc774\ud2b8 \ub41c \uac1d\uccb4(",(0,a.kt)("inlineCode",{parentName:"li"},"copy_"),")\ub97c \uc0ac\uc6a9\ud558\uace0 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc740 \uac1d\uccb4\ub294 \uae30\uc874 \uac1d\uccb4(",(0,a.kt)("inlineCode",{parentName:"li"},"base_"),")\ub97c \uc0ac\uc6a9\ud568\uc73c\ub85c\uc368 structuring share\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc0c8\ub85c\uc6b4 \uac1d\uccb4\ub97c \ub9cc\ub4e4\uc5b4\uc11c \ub9ac\ud134\ud55c\ub2e4.")),(0,a.kt)("h2",{id:"\uad81\uae08\uc99d-\ud574\uc18c"},"\uad81\uae08\uc99d \ud574\uc18c"),(0,a.kt)("admonition",{title:"Question",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Q1. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\ub294 mutable\ud558\uac8c \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub294 \uac83\uc744 \uc5b4\ub5bb\uac8c immutable\ud55c \ubc29\uc2dd\uc73c\ub85c \ubc14\uafb8\uc5b4\uc8fc\uace0 \uc788\uc744\uae4c?")),(0,a.kt)("p",null,"A1. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"new Proxy"),"\ub97c \uc0ac\uc6a9\ud558\uc5ec get\uacfc set \ub85c\uc9c1\uc744 intercept\ud558\uae30 \ub54c\ubb38\uc5d0 \uac1d\uccb4\ub97c mutable\ud558\uac8c \ubcc0\uacbd\ud558\ub354\ub77c\ub3c4 \uac1d\uccb4\uac00 \uc9c1\uc811\uc801\uc73c\ub85c \ubcc0\uacbd\ub418\uc9c0 \uc54a\ub294\ub2e4.\nset\ub85c\uc9c1\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\ub97c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub85c shallow copy\ud558\uc5ec ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_")," \uac1d\uccb4\uc5d0 \uc5c5\ub370\uc774\ud2b8\ub97c \uc9c4\ud589\ud55c\ub2e4."),(0,a.kt)("p",null,"\ubaa8\ub4e0 \uc5c5\ub370\uc774\ud2b8\uac00 \ub05d\ub098\uba74 \uac12\uc744 \ub9ac\ud134\ud560\ub54c \uac1d\uccb4\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0\ub97c \ud310\ub2e8\ud574\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ud639\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),"\ub97c \ub9ac\ud134\ud568\uc73c\ub85c\uc368 \uac1d\uccb4\ub97c immutable\ud558\uac8c \uc5c5\ub370\uc774\ud2b8 \ud560 \uc218 \uc788\ub2e4."),(0,a.kt)("admonition",{title:"Question",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Q2. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\ub294 \uc5b4\ub5a4 \ubc29\uc2dd\uc73c\ub85c structural sharing\uc744 \uc0ac\uc6a9\ud558\ub294\uac00?")),(0,a.kt)("p",null,"A2. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\ub294 \uac1d\uccb4\uc758 \ubcc0\uacbd\uc5ec\ubd80\uc5d0 \ub530\ub77c\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\uac12\uc744 \uad00\ub9ac\ud55c\ub2e4. ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\uac00 true\ub77c\uba74 \uac1d\uccb4\uac00 \uc5c5\ub370\uc774\ud2b8 \ub418\uc5c8\ub2e4\ub294 \uac83\uc774\ub2e4.\n",(0,a.kt)("inlineCode",{parentName:"p"},"modified_")," \uac12\uc744 \ubcf4\uace0 true\ub77c\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),"\ub77c\ub294 \uc0c8\ub85c\uc6b4 \uac1d\uccb4\ub97c \ub9ac\ud134\ud558\uc5ec \uc0c8\ub85c\uc6b4 reference\ub97c \uc0ac\uc6a9\ud558\uace0,\n",(0,a.kt)("inlineCode",{parentName:"p"},"modifed_"),"\uac00 false\ub77c\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_")," \uac1d\uccb4, \uae30\uc874 \uac1d\uccb4\ub97c \ubc18\ud658\ud568\uc73c\ub85c\uc368 \uae30\uc874 reference\ub97c \uc0ac\uc6a9\ud55c\ub2e4.\n\ub530\ub77c\uc11c \ubcc0\uacbd\ub41c \uc5ec\ubd80\uc5d0 \ub300\ud55c boolean\uc744 \uad00\ub9ac\ud558\uace0 \uadf8 \uc5ec\ubd80\uc5d0 \ub530\ub77c \uae30\uc874 \uac83\uc744 \uc0ac\uc6a9\ud558\uac70\ub098 \uc0c8\ub85c\uc6b4 \uac83\uc744 \uc0ac\uc6a9\ud574\uc11c structural sharing\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4."),(0,a.kt)("admonition",{title:"Question",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Q3. ",(0,a.kt)("inlineCode",{parentName:"p"},"immer"),"\uc5d0\uc11c\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"produce"),"\ud568\uc218 \ub0b4\uc5d0\uc11c \uac1d\uccb4\ub97c \uc9c1\uc811 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ubc29\uc2dd\uc774 \uc544\ub2c8\ub77c return\uc744 \ud1b5\ud574\uc11c \ub370\uc774\ud130\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\ub294\ub370, \uc774\ub7f0 \uacbd\uc6b0\uc5d0 immer\uc758 \ub85c\uc9c1\uc5d0 \ucc28\uc774\uac00 \uc788\uc744\uae4c?")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"produce")," \ud568\uc218 \ub0b4\uc5d0\uc11c return\uc744 \ud558\ub294\uc9c0 \uc544\ub2cc\uc9c0 \uc5ec\ubd80\ub294 immer\uc758 finalize, \uc5c5\ub370\uc774\ud2b8 \ub41c \uac1d\uccb4\ub97c \uc900\ube44\ud558\ub294 \uacfc\uc815\uc5d0\uc11c \ucc28\uc774\uac00 \ub09c\ub2e4.\nreturn\uc744 \ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"produce")," \ub0b4\ubd80\uc5d0\uc11c \uac1d\uccb4\ub97c \uc9c1\uc811 \ubcc0\uacbd\ud588\ub2e4\ub294 \uc758\ubbf8\uc774\uace0 \uadf8\ub807\ub2e4\uba74 immer\uc5d0\uc11c \uad6c\ud604\ud558\ub294 Proxy\ub85c\uc9c1\uc778 get, set\uc744 \uc774\uc6a9\ud558\uc5ec\n\uac1d\uccb4\ub97c \uc5c5\ub370\uc774\ud2b8 \ud588\ub2e4\ub294 \uac83\uc774\ub2e4. \uadf8\ub807\ub2e4\uba74 \uc774 \uae00\uc5d0\uc11c \uc54c\uc544\ubcf4\uc558\ub358 ",(0,a.kt)("inlineCode",{parentName:"p"},"base_"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"copy_"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_")," \ub4f1 \uc5ec\ub7ec \ubcc0\uc218\uc640 \ub85c\uc9c1\ub4e4\uc744 \uc774\uc6a9\ud574\uc11c \uac1d\uccb4 \uc5c5\ub370\uc774\ud2b8\ub97c \uc9c4\ud589\ud55c\ub2e4."),(0,a.kt)("p",null,"\ud558\uc9c0\ub9cc, return\uc744 \ud55c\ub2e4\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c? ",(0,a.kt)("inlineCode",{parentName:"p"},"produce"),"\uc5d0\uc11c return \uac12\uc774 \uc874\uc7ac\ud55c\ub2e4\uba74 immer\uc5d0\uc11c \uc900\ube44\ud55c Proxy get, set \ub4f1 \ub85c\uc9c1\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0\n\uacb0\uacfc\uac12\uc744 \uadf8\ub300\ub85c \ub9ac\ud134\ud558\uace0 \uc788\ub2e4\ub294 \uc758\ubbf8\uc774\ub2e4. \ub530\ub77c\uc11c root proxy\ub97c \ud615\uc131\ud558\uace0 get\uc744 \ud1b5\ud574\uc11c \uac1d\uccb4\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uace0 set\uc73c\ub85c ",(0,a.kt)("inlineCode",{parentName:"p"},"modified_"),"\ub97c \ubcc0\uacbd\ud558\ub294 \ub4f1 \ub85c\uc9c1\uc744 \ubaa8\ub450\n\uc2a4\ud0b5\ud558\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"finalize")," \uacfc\uc815\uc73c\ub85c \ub118\uc5b4\uc628\ub2e4. \uc774\ub294 immer\uc758 \ub300\ubd80\ubd84\uc758 \ub85c\uc9c1\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 \uacb0\uacfc\ub97c \ub9ac\ud134\ud55c\ub2e4\ub294 \uc758\ubbf8\uc774\ub2e4."),(0,a.kt)("p",null,"\ub450 \ubc29\ubc95 \ubaa8\ub450 \uac1d\uccb4\ub97c immutable\ud558\uac8c \uad00\ub9ac\ud558\uc5ec \uc5c5\ub370\uc774\ud2b8\ud55c\ub2e4. \uadf8\ub9ac\uace0 \ub450 \ubc29\uc2dd \ubaa8\ub450 \ubcc0\uacbd\ub41c \uac1d\uccb4\ub9cc reference\uac00 \ubc14\ub00c\ub294 structural sharing\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4.\n\ubb3c\ub860 \ub450\ubc88\uc9f8 \ubc29\ubc95, \uc5c5\ub370\uc774\ud2b8 \ub41c \uac1d\uccb4\ub97c \ub9ac\ud134\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud55c\ub2e4\uba74 \ubd88\ud544\uc694\ud558\uac8c \uac1d\uccb4\ub97c \uc0c8\ub85c \ub9cc\ub4e4\uc9c0 \uc54a\uac8c \uc8fc\uc758\ub294 \ud544\uc694\ud558\ub2e4. \uacb0\uacfc\uc801\uc73c\ub85c \uc774\uc57c\uae30\ud558\uba74 \uc5b4\ub290\ucabd\uc774\ub4e0 \ub3d9\uc77c\ud558\ub2e4.\n\ucc28\uc774\uc810\uc744 \uace0\ub974\uc790\uba74 \uc5b4\ub5a4 \ubc29\uc2dd\uc73c\ub85c \uac1d\uccb4\ub97c \ubcc0\uacbd\ud558\ub290\ub0d0\uc5d0 \ub300\ud55c \uac83\uc77c \ubfd0\uc774\ub2e4. \uadf8\ub807\ub2e4\uba74 \uc120\ud0dd\uc758 \uc601\uc5ed\uc774\ub2e4.\nmutable\ud558\uac8c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uc744 \uc120\ud0dd\ud558\ub290\ub0d0, immutable\ud558\uac8c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uc744 \uc120\ud0dd\ud558\ub290\ub0d0\ub97c \uace0\ubbfc\ud558\uba74 \ub41c\ub2e4. "),(0,a.kt)("p",null,"\ubb3c\ub860, \uc8fc\uad00\uc801\uc778 \uc758\uacac\uc744 \uc774\uc57c\uae30\ud558\uc790\uba74 \uc5b4\ub5a4 \uac1d\uccb4\ub97c \uc5b4\ub5bb\uac8c \uc5c5\ub370\uc774\ud2b8 \ud558\uace0\uc790\ud558\ub294\uc9c0 \ubaa9\uc801\uc5d0 \ub530\ub77c\uc11c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ubc29\uc2dd\uc774 \ub2ec\ub77c\uc9c4\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.\n\ub530\ub77c\uc11c immutable\ud558\uac8c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uc758 \uc7a5\ub2e8\uc810, mutable\ud558\uac8c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uc758 \uc7a5\ub2e8\uc810\uc744 \uac01\uac01 \uc774\ud574\ud558\uace0, \uc0c1\ud669\uc5d0 \ub9de\uac8c \ud63c\uc6a9\ud574\uc11c \uc0ac\uc6a9\uc744 \ud558\uba74 \ub420 \uac83\uc774\ub77c\uace0 \uc0dd\uac01\ud55c\ub2e4."),(0,a.kt)("h2",{id:"reference"},"Reference"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://immerjs.github.io/immer/"},"immer official docs")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/immerjs/immer/tree/v9.0.6"},"immer repository v9.0.6")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://ko.redux.js.org/style-guide/style-guide/#use-redux-toolkit-for-writing-redux-logic"},"redux style guide")," "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/createReducer#direct-state-mutation"},"redux-toolkit guide")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://medium.com/hackernoon/introducing-immer-immutability-the-easy-way-9d73d8f71cb3#3bff"},"[blog] Introducing immer: Immutability the easy way")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"},"Proxy MDN"))))}u.isMDXComponent=!0}}]);